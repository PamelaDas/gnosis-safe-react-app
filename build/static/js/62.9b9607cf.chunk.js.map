{"version":3,"sources":["components/Divider/index.tsx","components/ExecuteCheckbox/index.tsx","logic/hooks/useDebounce.tsx","utils/url.ts","routes/safe/components/Apps/components/ConfirmTxModal/SafeAppLoadError.tsx","components/DecodeTxs/index.tsx","utils/decodeTx.ts","routes/safe/components/Apps/components/ConfirmTxModal/ReviewConfirm.tsx","components/ModalTitle/index.tsx","routes/safe/components/Apps/components/ConfirmTxModal/DecodedTxDetail.tsx","routes/safe/components/Apps/components/ConfirmTxModal/index.tsx","routes/safe/components/Apps/communicator.ts","routes/safe/components/Apps/hooks/useSignMessageModal.ts","routes/safe/components/Apps/components/SignMessageModal/ReviewMessage.tsx","routes/safe/components/Apps/components/SignMessageModal/index.tsx","routes/safe/components/Apps/components/AppFrame.tsx","routes/safe/components/Apps/hooks/useIframeMessageHandler.ts","routes/safe/components/Apps/assets/addApp.svg","routes/safe/components/Apps/components/AppCard/skeleton.tsx","routes/safe/components/Apps/components/AppCard/index.tsx","routes/safe/components/Apps/components/SearchInputCard.tsx","routes/safe/components/Apps/components/NoAppsFound.tsx","routes/safe/components/Apps/components/AddAppForm/AppAgreement.tsx","routes/safe/components/Apps/components/AddAppForm/AppUrl.tsx","routes/safe/components/Apps/components/AddAppForm/FormButtons.tsx","routes/safe/components/Apps/components/AddAppForm/index.tsx","logic/safe/api/fetchSafeApps.ts","routes/safe/components/Apps/hooks/appList/useAppList.ts","routes/safe/components/Apps/hooks/appList/useRemoteSafeApps.ts","routes/safe/components/Apps/hooks/appList/useCustomSafeApps.ts","routes/safe/components/Apps/hooks/appList/usePinnedSafeApps.ts","routes/safe/components/Apps/components/PinnedAppsTutorial.tsx","routes/safe/components/Apps/components/AppsList.tsx","routes/safe/components/Apps/hooks/useAppsSearch.ts","routes/safe/components/Apps/components/LegalDisclaimer.tsx","routes/safe/components/Apps/hooks/useLegalConsent.ts","routes/safe/components/Apps/index.tsx"],"names":["Wrapper","styled","div","StyledDivider","DividerSRC","Divider","withArrow","type","size","ExecuteCheckbox","onChange","margin","noMargin","control","defaultChecked","color","e","target","checked","label","useDebounce","value","delay","options","previousValue","useRef","useState","current","setCurrent","debouncedCallback","useMemo","debounce","val","useEffect","cancel","isValidURL","url","protocolsAllowed","urlInfo","URL","includes","protocol","error","Container","theme","sm","lg","IconText","FooterWrapper","SafeAppLoadError","onTxReject","onClose","requestId","cancelText","handleCancel","handleOk","okDisabled","okText","FlexWrapper","BasicTxInfoWrapper","TxList","colors","separator","TxListItem","ElementWrapper","getByteLength","data","Array","isArray","split","reduce","result","hex","hexToBytes","length","err","BasicTxInfo","txRecipient","txData","txValue","recipientName","nativeCurrency","getNativeCurrency","strong","symbol","PrefixedEthHashInfo","hash","showAvatar","textSize","showCopyBtn","name","explorerUrl","getExplorerInfo","textToCopy","getParameterElement","parameter","index","valueElement","startsWith","endsWith","JSON","stringify","SingleTx","decodedData","onTxItemClick","onClick","iconSize","iconType","text","method","MultiSendTx","txs","get","map","tx","dataDecoded","DecodeTxs","fetchTxDecoder","encodedData","a","getDecodedData","GATEWAY_URL","_getChainId","md","DecodeTxsWrapper","StyledBlock","Block","ReviewConfirm","app","safeAddress","ethBalance","safeName","params","hidden","onUserConfirm","onReject","showDecodedTxData","isMultiSend","setDecodedData","dispatch","useDispatch","isOwner","useSelector","grantedSelector","getMultisendContractAddress","to","encodeMultiSendCall","toBN","toString","operation","Operation","DELEGATE","CALL","manualSafeTxGas","setManualSafeTxGas","manualGasPrice","setManualGasPrice","manualGasLimit","setManualGasLimit","useEstimateTransactionGas","txAmount","safeTxGas","gasLimit","gasPriceFormatted","gasEstimation","isOffChainSignature","isCreation","isExecution","gasCostFormatted","txEstimationExecutionStatus","useEstimationStatus","buttonStatus","setButtonStatus","executionApproved","setExecutionApproved","doExecute","decodeTxData","res","handleUserConfirmation","safeTxHash","EditableTxParameters","ethGasLimit","ethGasPrice","Math","max","parseInt","closeEditModalCallback","txParameters","oldGasPrice","newGasPrice","oldSafeTxGas","newSafeTxGas","toggleEditMode","ModalHeader","title","iconUrl","Hairline","fromTokenUnit","decimals","TxParametersDetail","onEdit","isTransactionCreation","isTransactionExecution","EstimationStatus","LOADING","ReviewInfoText","undefined","safeNonce","Modal","Footer","withoutBorder","Buttons","cancelButtonProps","confirmButtonProps","ButtonStatus","createTransaction","valueInWei","origin","id","navigateToTransactionsTab","txNonce","ethParameters","notifiedTransaction","TX_NOTIFICATION_TYPES","STANDARD_TX","delayExecution","READY","confirmTransactions","disabled","status","StyledParagraph","Paragraph","IconImg","img","TitleWrapper","StyledRow","Row","StyledClose","Close","GoBackWrapper","ModalTitle","goBack","align","grow","IconButton","alt","src","weight","disableRipple","DecodedTxDetail","body","hideDecodedTxData","decodedTxData","parameters","p","ConfirmTxModal","props","decodedTxDetails","setDecodedTxDetails","invalidTransactions","some","t","test","mustBeEthereumAddress","isTxValid","rejectTransaction","description","open","isOpen","AppCommunicator","iframeRef","handlers","Map","on","handler","set","isValidMessage","msg","sentFromIframe","source","parent","window","knownMethod","Object","values","Methods","canHandleMessage","Boolean","send","sdkVersion","getSDKVersion","MessageFormatter","makeErrorResponse","makeResponse","contentWindow","postMessage","handleIncomingMessage","validMessage","hasHandler","response","message","trackError","Errors","_901","contexts","safeApp","request","clear","removeEventListener","this","addEventListener","INITIAL_MODAL_STATE","MessageTextArea","MuiTextField","InfoMessage","xs","ReviewMessage","utf8Message","handleTxRejection","rows","multiline","fullWidth","inputProps","placeholder","InputProps","disableUnderline","SignMessageModal","rest","web3","getWeb3ReadOnly","networkId","currentChainId","getSignMessageLibAddress","ZERO_ADDRESS","getSignMessageLibContractInstance","methods","signMessage","eth","accounts","hashMessage","encodeABI","readableData","isHex","isHexStrict","humanReadableMessage","hexToUtf8","convertToHumanReadableMessage","AppWrapper","StyledCard","Card","StyledIframe","iframe","isLoading","INITIAL_CONFIRM_TX_MODAL_STATE","safeAppWeb3Provider","Web3","providers","HttpProvider","getSafeAppsRpcServiceUrl","timeout","AppFrame","appUrl","currentSafe","address","owners","threshold","getChainInfo","chainId","chainName","shortName","state","addressBookEntryName","trackEvent","useAnalytics","confirmTransactionModal","setConfirmTransactionModal","appIsLoading","setAppIsLoading","getEmptySafeApp","setSafeApp","signMessageModalState","setSignMessageModalState","useCallback","useSignMessageModal","openSignMessageModal","closeSignMessageModal","timer","isLoadingSlow","setIsLoadingSlow","errorTimer","setAppLoadError","clearTimeouts","clearTimeout","setTimeout","SAFE_POLLING_INTERVAL","Error","openConfirmationModal","closeConfirmationModal","selectedApp","closeModal","useSnackbar","enqueueSnackbar","closeSnackbar","currentSafeWithNames","sendMessageToIframe","requestWithMessage","trunc","performance","now","version","handleIframeMessage","messageId","messagePayload","SDK_MESSAGES","SEND_TRANSACTIONS","SAFE_APP_SDK_INITIALIZED","safeInfoMessage","INTERFACE_MESSAGES","ON_SAFE_INFO","network","getChainName","toLowerCase","envInfoMessage","ENV_INFO","txServiceUrl","getTxServiceUrl","console","onIframeMessage","useIframeMessageHandler","onIframeLoad","url1","url2","b","href","isSameURL","communicator","setCommunicator","communicatorInstance","initCommunicator","useAppCommunicator","getTxBySafeTxHash","fetchSafeTransaction","getSafeInfo","getSafeBalances","currency","fetchTokenCurrenciesBalances","selectedCurrency","balances","rpcCall","Promise","resolve","reject","jsonrpc","call","sendTransactions","onUserTxConfirm","TRANSACTION_CONFIRMED","TRANSACTION_REJECTED","loadApp","getAppInfoFromUrl","logError","_900","SAFE_EVENTS","SAFE_APP","style","flexDirection","frameBorder","ref","onLoad","gradientSK","keyframes","AppIconSK","TitleSK","DescriptionSK","StyledAppCard","alpha","shadow","secondary","background","primary","IconBtn","AppContainer","motion","AppName","Title","AppDescription","Text","StyledLink","Link","setAppImageFallback","currentTarget","onerror","appsIconSvg","getPinLabel","pinned","AppCard","onPin","onRemove","FETCH_STATUS","fetchStatus","isAppLoading","layout","initial","opacity","animate","exit","content","onError","preventDefault","AddCustomAppCard","AddAppIcon","variant","SearchInputCard","onValueChange","Input","startAdornment","endAdornment","event","width","NoAppsFoundTextContainer","xxl","SButton","Button","NoAppsFound","query","onWalletConnectSearch","StyledCheckbox","Checkbox","AppAgreement","visited","useFormState","subscription","validate","agreementAccepted","required","Field","component","validateUrl","appUrlResolver","createDecorator","field","updates","isValidEnsName","getIpfsLinkFromEns","ensContent","AppInfoUpdater","onAppInfo","onLoading","useField","input","debouncedValue","updateAppInfo","appInfo","StyledAppUrlField","AppUrl","appList","composeValidators","uniqueApp","TextField","autoComplete","FormButtons","onCancel","valid","validating","isSubmitDisabled","fieldsVisited","isAppManifestValid","StyledTextFileAppName","AppInfo","AppDocsInfo","WrapperLoader","StyledLoader","Loader","INITIAL_VALUES","DEFAULT_APP_INFO","AddApp","onAddApp","setAppInfo","fetchError","setFetchError","history","useHistory","setIsLoading","handleSubmit","push","pathname","generateSafeRoute","SAFE_ROUTES","APPS","extractPrefixedSafeAddress","search","encodeURIComponent","_903","GnoForm","decorators","initialValues","onSubmit","testId","Body","as","rel","Img","readOnly","meta","fetchSafeAppsList","getSafeApps","useAppList","remoteSafeApps","setRemoteSafeApps","NOT_ASKED","setStatus","loadAppsList","SUCCESS","String","ERROR","_902","NOTIFICATIONS","SAFE_APPS_FETCH_ERROR_MSG","useRemoteSafeApps","remoteAppsFetchStatus","customSafeApps","setCustomSafeApps","loaded","setLoaded","updateCustomSafeApps","newCustomSafeApps","saveToStorage","APPS_STORAGE_KEY","fetchAppCallback","prev","prevAppsCopy","appIndex","findIndex","splice","loadCustomApps","loadFromStorage","storageAppList","serializedApps","trim","custom","forEach","then","appFromUrl","catch","useCustomSafeApps","pinnedSafeAppIds","updatePinnedSafeApps","loadPinnedAppIds","PINNED_SAFE_APP_IDS","pinnedAppIds","filteredPinnedAppsIds","filter","pinnedAppId","usePinnedSafeApps","remoteIsLoading","allApps","sort","localeCompare","customApps","persistedApp","pinnedSafeApps","addCustomApp","newList","removeApp","appId","newPersistedList","togglePin","appName","newPinnedIds","SAFE_APP_EVENTS","PIN","indexOf","UNPIN","StyledBookmarkIcon","BookmarkBorder","PinnedAppsTutorial","InfoIcon","centerCSS","css","LoadingContainer","CardsWrapper","ContentWrapper","SectionHeading","xl","CenterIconText","AppsList","extractSafeAddress","appsPath","getShortName","appSearch","setAppSearch","apps","searchText","fuse","Fuse","keys","findAllMatches","item","useAppsSearch","appToRemove","setAppToRemove","useStateHandler","isAddAppModalOpen","openAddAppModal","toggle","closeAddAppModal","clickAway","noAppsFound","showCustomApps","showPinnedApps","handleAppPin","Col","start","replace","Collapse","defaultExpanded","AnimatePresence","encodeURI","pinnedApp","handleClose","Header","AddAppForm","LegalDisclaimer","onConfirm","APPS_LEGAL_CONSENT_RECEIVED","Apps","getAppUrl","useSafeAppUrl","consentReceived","setConsentReceived","onConsentReceipt","useLegalConsent"],"mappings":"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","file":"static/js/62.9b9607cf.chunk.js","sourcesContent":["import { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Icon, Divider as DividerSRC } from '@gnosis.pm/safe-react-components'\r\n\r\nconst Wrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  margin: 8px 0;\r\n\r\n  svg {\r\n    margin: 0 12px 0 4px;\r\n  }\r\n`\r\nconst StyledDivider = styled(DividerSRC)`\r\n  width: 100%;\r\n`\r\n\r\ntype Props = {\r\n  withArrow?: boolean\r\n}\r\n\r\nconst Divider = ({ withArrow }: Props): ReactElement => (\r\n  <Wrapper>\r\n    {withArrow && <Icon type=\"arrowDown\" size=\"md\" />}\r\n    <StyledDivider />\r\n  </Wrapper>\r\n)\r\n\r\nexport default Divider\r\n","import { ReactElement } from 'react'\r\nimport { Checkbox, FormControlLabel } from '@material-ui/core'\r\nimport Row from 'src/components/layout/Row'\r\nimport Paragraph from '../layout/Paragraph'\r\n\r\ninterface ExecuteCheckboxProps {\r\n  onChange: (val: boolean) => unknown\r\n}\r\n\r\nconst ExecuteCheckbox = ({ onChange }: ExecuteCheckboxProps): ReactElement | null => {\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\r\n    onChange(e.target.checked)\r\n  }\r\n  return (\r\n    <Row margin=\"md\">\r\n      <Paragraph noMargin>\r\n        If you want to sign the transaction now but manually execute it later, click on the checkbox below.\r\n      </Paragraph>\r\n      <FormControlLabel\r\n        control={<Checkbox defaultChecked color=\"primary\" onChange={handleChange} />}\r\n        label=\"Execute transaction\"\r\n        data-testid=\"execute-checkbox\"\r\n      />\r\n    </Row>\r\n  )\r\n}\r\n\r\nexport default ExecuteCheckbox\r\n","import debounce from 'lodash/debounce'\r\nimport { useMemo, useEffect, useState, useRef } from 'react'\r\n\r\n/*\r\n  This code snippet is copied from https://github.com/gnbaron/use-lodash-debounce\r\n  with the sole intention to be able to tweak it if is needed and prevent from having\r\n  a new dependency for something relatively trivial\r\n*/\r\n\r\ninterface DebounceOptions {\r\n  leading: boolean\r\n  maxWait: number\r\n  trailing: boolean\r\n}\r\n\r\nexport const useDebounce = <T extends unknown>(value: T, delay = 0, options?: DebounceOptions): T => {\r\n  const previousValue = useRef(value)\r\n  const [current, setCurrent] = useState(value)\r\n  const debouncedCallback = useMemo(\r\n    () => debounce((val: T) => setCurrent(val), delay, options),\r\n    [setCurrent, delay, options],\r\n  )\r\n\r\n  useEffect(() => {\r\n    // does trigger the debounce timer initially\r\n    if (value !== previousValue.current) {\r\n      debouncedCallback(value)\r\n      previousValue.current = value\r\n      // cancel the debounced callback on clean up\r\n      return debouncedCallback.cancel\r\n    }\r\n  }, [debouncedCallback, value, previousValue])\r\n\r\n  return current\r\n}\r\n","export const isValidURL = (url: string, protocolsAllowed = ['https:', 'http:']): boolean => {\r\n  try {\r\n    const urlInfo = new URL(url)\r\n    return protocolsAllowed.includes(urlInfo.protocol)\r\n  } catch (error) {\r\n    return false\r\n  }\r\n}\r\n\r\nexport const isSameURL = (url1: string, url2: string): boolean => {\r\n  try {\r\n    const a = new URL(url1)\r\n    const b = new URL(url2)\r\n    return a.href === b.href\r\n  } catch (error) {\r\n    return false\r\n  }\r\n}\r\n","import { ReactElement } from 'react'\r\nimport { Icon, Text, Title, ModalFooterConfirmation } from '@gnosis.pm/safe-react-components'\r\nimport styled from 'styled-components'\r\nimport { ConfirmTxModalProps } from '.'\r\n\r\nconst Container = styled.div`\r\n  padding: ${({ theme }) => `${theme.margin.sm} ${theme.margin.lg}`};\r\n`\r\n\r\nconst IconText = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  span {\r\n    margin-right: 4px;\r\n  }\r\n`\r\n\r\nconst FooterWrapper = styled.div`\r\n  margin-top: 15px;\r\n`\r\n\r\nexport const SafeAppLoadError = ({ onTxReject, onClose, requestId }: ConfirmTxModalProps): ReactElement => {\r\n  const handleTxRejection = () => {\r\n    onTxReject(requestId)\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <Container>\r\n      <IconText>\r\n        <Icon color=\"error\" size=\"md\" type=\"info\" />\r\n        <Title size=\"xs\">Transaction error</Title>\r\n      </IconText>\r\n      <Text size=\"lg\">\r\n        This Safe App initiated a transaction which cannot be processed. Please get in touch with the developer of this\r\n        Safe App for more information.\r\n      </Text>\r\n\r\n      <FooterWrapper>\r\n        <ModalFooterConfirmation\r\n          cancelText=\"Cancel\"\r\n          handleCancel={() => handleTxRejection()}\r\n          handleOk={() => {}}\r\n          okDisabled={true}\r\n          okText=\"Submit\"\r\n        />\r\n      </FooterWrapper>\r\n    </Container>\r\n  )\r\n}\r\n","import { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Transaction } from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport {\r\n  DecodedDataResponse,\r\n  DecodedDataBasicParameter,\r\n  DecodedDataParameterValue,\r\n} from '@gnosis.pm/safe-react-gateway-sdk'\r\nimport get from 'lodash/get'\r\nimport { Text, CopyToClipboardBtn, IconText, FixedIcon } from '@gnosis.pm/safe-react-components'\r\nimport { hexToBytes } from 'web3-utils'\r\n\r\nimport { getExplorerInfo, getNativeCurrency } from 'src/config'\r\nimport { DecodedTxDetail } from 'src/routes/safe/components/Apps/components/ConfirmTxModal'\r\nimport PrefixedEthHashInfo from '../PrefixedEthHashInfo'\r\n\r\nconst FlexWrapper = styled.div<{ margin: number }>`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  > :nth-child(2) {\r\n    margin-left: ${({ margin }) => margin}px;\r\n  }\r\n`\r\n\r\nconst BasicTxInfoWrapper = styled.div`\r\n  margin-bottom: 15px;\r\n\r\n  > :nth-child(2) {\r\n    margin-bottom: 15px;\r\n  }\r\n`\r\n\r\nconst TxList = styled.div`\r\n  width: 100%;\r\n  max-height: 260px;\r\n  overflow-y: auto;\r\n  border-top: 2px solid ${({ theme }) => theme.colors.separator};\r\n`\r\n\r\nconst TxListItem = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n\r\n  padding: 0 24px;\r\n  height: 50px;\r\n  border-bottom: 2px solid ${({ theme }) => theme.colors.separator};\r\n\r\n  :hover {\r\n    cursor: pointer;\r\n  }\r\n`\r\nconst ElementWrapper = styled.div`\r\n  margin-bottom: 15px;\r\n`\r\n\r\nexport const getByteLength = (data: string | string[]): number => {\r\n  try {\r\n    if (!Array.isArray(data)) {\r\n      data = data.split(',')\r\n    }\r\n    // Return the sum of the byte sizes of each hex string\r\n    return data.reduce((result, hex) => {\r\n      const bytes = hexToBytes(hex)\r\n      return result + bytes.length\r\n    }, 0)\r\n  } catch (err) {\r\n    return 0\r\n  }\r\n}\r\n\r\nexport const BasicTxInfo = ({\r\n  txRecipient,\r\n  txData,\r\n  txValue,\r\n  recipientName,\r\n}: {\r\n  txRecipient: string\r\n  txData: string\r\n  txValue: string\r\n  recipientName?: string\r\n}): ReactElement => {\r\n  const nativeCurrency = getNativeCurrency()\r\n\r\n  return (\r\n    <BasicTxInfoWrapper>\r\n      {/* TO */}\r\n      <>\r\n        <Text size=\"lg\" strong>\r\n          {`Send ${txValue} ${nativeCurrency.symbol} to:`}\r\n        </Text>\r\n        <PrefixedEthHashInfo\r\n          hash={txRecipient}\r\n          showAvatar\r\n          textSize=\"lg\"\r\n          showCopyBtn\r\n          name={recipientName}\r\n          explorerUrl={getExplorerInfo(txRecipient)}\r\n        />\r\n      </>\r\n      <>\r\n        {/* Data */}\r\n        <Text size=\"lg\" strong>\r\n          Data (hex encoded):\r\n        </Text>\r\n        <FlexWrapper margin={5}>\r\n          <Text size=\"lg\">{txData ? getByteLength(txData) : 0} bytes</Text>\r\n          <CopyToClipboardBtn textToCopy={txData} />\r\n        </FlexWrapper>\r\n      </>\r\n    </BasicTxInfoWrapper>\r\n  )\r\n}\r\n\r\nexport const getParameterElement = (parameter: DecodedDataBasicParameter, index: number): ReactElement => {\r\n  let valueElement\r\n\r\n  if (parameter.type === 'address') {\r\n    valueElement = (\r\n      <PrefixedEthHashInfo\r\n        hash={parameter.value}\r\n        showAvatar\r\n        textSize=\"lg\"\r\n        showCopyBtn\r\n        explorerUrl={getExplorerInfo(parameter.value)}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (parameter.type.startsWith('bytes')) {\r\n    valueElement = (\r\n      <FlexWrapper margin={5}>\r\n        <Text size=\"lg\">{getByteLength(parameter.value)} bytes</Text>\r\n        <CopyToClipboardBtn textToCopy={parameter.value} />\r\n      </FlexWrapper>\r\n    )\r\n  }\r\n\r\n  if (!valueElement) {\r\n    let value = parameter.value\r\n    if (parameter.type.endsWith('[]')) {\r\n      try {\r\n        value = JSON.stringify(parameter.value)\r\n      } catch (e) {}\r\n    }\r\n    valueElement = <Text size=\"lg\">{value}</Text>\r\n  }\r\n\r\n  return (\r\n    <ElementWrapper key={index}>\r\n      <Text size=\"lg\" strong>\r\n        {parameter.name} ({parameter.type})\r\n      </Text>\r\n      {valueElement}\r\n    </ElementWrapper>\r\n  )\r\n}\r\n\r\nconst SingleTx = ({\r\n  decodedData,\r\n  onTxItemClick,\r\n}: {\r\n  decodedData: DecodedDataResponse | null\r\n  onTxItemClick: (decodedTxDetails: DecodedDataResponse) => void\r\n}): ReactElement | null => {\r\n  if (!decodedData) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <TxList>\r\n      <TxListItem onClick={() => onTxItemClick(decodedData)}>\r\n        <IconText iconSize=\"sm\" iconType=\"code\" text=\"Contract interaction\" textSize=\"xl\" />\r\n\r\n        <FlexWrapper margin={20}>\r\n          <Text size=\"xl\">{decodedData.method}</Text>\r\n          <FixedIcon type=\"chevronRight\" />\r\n        </FlexWrapper>\r\n      </TxListItem>\r\n    </TxList>\r\n  )\r\n}\r\n\r\nconst MultiSendTx = ({\r\n  decodedData,\r\n  onTxItemClick,\r\n}: {\r\n  decodedData: DecodedDataResponse | null\r\n  onTxItemClick: (decodedTxDetails: DecodedDataParameterValue) => void\r\n}): ReactElement | null => {\r\n  const txs: DecodedDataParameterValue[] | undefined = get(decodedData, 'parameters[0].valueDecoded')\r\n\r\n  if (!txs) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <TxList>\r\n      {txs.map((tx, index) => (\r\n        <TxListItem key={index} onClick={() => onTxItemClick(tx)}>\r\n          <IconText iconSize=\"sm\" iconType=\"code\" text=\"Contract interaction\" textSize=\"xl\" />\r\n\r\n          <FlexWrapper margin={20}>\r\n            {tx.dataDecoded && <Text size=\"xl\">{tx.dataDecoded.method}</Text>}\r\n            <FixedIcon type=\"chevronRight\" />\r\n          </FlexWrapper>\r\n        </TxListItem>\r\n      ))}\r\n    </TxList>\r\n  )\r\n}\r\n\r\ntype Props = {\r\n  txs: Transaction[]\r\n  decodedData: DecodedDataResponse | null\r\n  onTxItemClick: (decodedTxDetails: DecodedTxDetail) => void\r\n}\r\n\r\nexport const DecodeTxs = ({ txs, decodedData, onTxItemClick }: Props): ReactElement => {\r\n  return txs.length > 1 ? (\r\n    <MultiSendTx decodedData={decodedData} onTxItemClick={onTxItemClick} />\r\n  ) : (\r\n    <SingleTx decodedData={decodedData} onTxItemClick={onTxItemClick} />\r\n  )\r\n}\r\n","import { getDecodedData, DecodedDataResponse } from '@gnosis.pm/safe-react-gateway-sdk'\r\n\r\nimport { _getChainId } from 'src/config'\r\nimport { GATEWAY_URL } from './constants'\r\n\r\nexport const fetchTxDecoder = async (encodedData: string): Promise<DecodedDataResponse | null> => {\r\n  if (!encodedData?.length || encodedData === '0x') {\r\n    return null\r\n  }\r\n\r\n  try {\r\n    return await getDecodedData(GATEWAY_URL, _getChainId(), encodedData)\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n","import { Operation } from '@gnosis.pm/safe-react-gateway-sdk'\r\nimport { Text } from '@gnosis.pm/safe-react-components'\r\nimport { ReactElement, useEffect, useMemo, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport styled from 'styled-components'\r\nimport { toBN } from 'web3-utils'\r\nimport { DecodedDataResponse } from '@gnosis.pm/safe-react-gateway-sdk'\r\n\r\nimport { createTransaction } from 'src/logic/safe/store/actions/createTransaction'\r\nimport { getMultisendContractAddress } from 'src/logic/contracts/safeContracts'\r\nimport { TX_NOTIFICATION_TYPES } from 'src/logic/safe/transactions'\r\nimport { encodeMultiSendCall } from 'src/logic/safe/transactions/multisend'\r\nimport { getExplorerInfo, getNativeCurrency } from 'src/config'\r\nimport { EstimationStatus, useEstimateTransactionGas } from 'src/logic/hooks/useEstimateTransactionGas'\r\nimport { ModalHeader } from 'src/routes/safe/components/Balances/SendModal/screens/ModalHeader'\r\nimport { EditableTxParameters } from 'src/routes/safe/components/Transactions/helpers/EditableTxParameters'\r\nimport { TxParametersDetail } from 'src/routes/safe/components/Transactions/helpers/TxParametersDetail'\r\nimport { lg, md } from 'src/theme/variables'\r\nimport { useEstimationStatus } from 'src/logic/hooks/useEstimationStatus'\r\nimport { TxParameters } from 'src/routes/safe/container/hooks/useTransactionParameters'\r\nimport { BasicTxInfo, DecodeTxs } from 'src/components/DecodeTxs'\r\nimport { fetchTxDecoder } from 'src/utils/decodeTx'\r\nimport { fromTokenUnit } from 'src/logic/tokens/utils/humanReadableValue'\r\nimport Block from 'src/components/layout/Block'\r\nimport Hairline from 'src/components/layout/Hairline'\r\nimport Divider from 'src/components/Divider'\r\nimport { ButtonStatus, Modal } from 'src/components/Modal'\r\nimport PrefixedEthHashInfo from 'src/components/PrefixedEthHashInfo'\r\nimport { ReviewInfoText } from 'src/components/ReviewInfoText'\r\n\r\nimport { ConfirmTxModalProps, DecodedTxDetail } from '.'\r\nimport { grantedSelector } from 'src/routes/safe/container/selector'\r\nimport ExecuteCheckbox from 'src/components/ExecuteCheckbox'\r\n\r\nconst Container = styled.div`\r\n  max-width: 480px;\r\n  padding: ${md} ${lg} 0;\r\n`\r\n\r\nconst DecodeTxsWrapper = styled.div`\r\n  margin: 24px -24px;\r\n`\r\n\r\nconst StyledBlock = styled(Block)`\r\n  background-color: ${({ theme }) => theme.colors.separator};\r\n  width: fit-content;\r\n  padding: 5px 10px;\r\n  border-radius: 3px;\r\n  margin: 4px 0 0 40px;\r\n\r\n  display: flex;\r\n\r\n  > :nth-child(1) {\r\n    margin-right: 5px;\r\n  }\r\n`\r\n\r\ntype Props = ConfirmTxModalProps & {\r\n  onReject: () => void\r\n  showDecodedTxData: (decodedTxDetails: DecodedTxDetail) => void\r\n  hidden: boolean // used to prevent re-rendering the modal each time a tx is inspected\r\n}\r\n\r\nconst parseTxValue = (value: string | number): string => {\r\n  return toBN(value).toString()\r\n}\r\n\r\nexport const ReviewConfirm = ({\r\n  app,\r\n  txs,\r\n  safeAddress,\r\n  ethBalance,\r\n  safeName,\r\n  params,\r\n  hidden,\r\n  onUserConfirm,\r\n  onClose,\r\n  onReject,\r\n  requestId,\r\n  showDecodedTxData,\r\n}: Props): ReactElement => {\r\n  const isMultiSend = txs.length > 1\r\n  const [decodedData, setDecodedData] = useState<DecodedDataResponse | null>(null)\r\n  const dispatch = useDispatch()\r\n  const nativeCurrency = getNativeCurrency()\r\n  const explorerUrl = getExplorerInfo(safeAddress)\r\n  const isOwner = useSelector(grantedSelector)\r\n\r\n  const txRecipient: string | undefined = useMemo(\r\n    () => (isMultiSend ? getMultisendContractAddress() : txs[0]?.to),\r\n    [txs, isMultiSend],\r\n  )\r\n  const txData: string | undefined = useMemo(\r\n    () => (isMultiSend ? encodeMultiSendCall(txs) : txs[0]?.data),\r\n    [txs, isMultiSend],\r\n  )\r\n  const txValue: string | undefined = useMemo(\r\n    () => (isMultiSend ? '0' : parseTxValue(txs[0]?.value)),\r\n    [txs, isMultiSend],\r\n  )\r\n  const operation = useMemo(() => (isMultiSend ? Operation.DELEGATE : Operation.CALL), [isMultiSend])\r\n  const [manualSafeTxGas, setManualSafeTxGas] = useState('0')\r\n  const [manualGasPrice, setManualGasPrice] = useState<string | undefined>()\r\n  const [manualGasLimit, setManualGasLimit] = useState<string | undefined>()\r\n\r\n  const {\r\n    gasLimit,\r\n    gasPriceFormatted,\r\n    gasEstimation,\r\n    isOffChainSignature,\r\n    isCreation,\r\n    isExecution,\r\n    gasCostFormatted,\r\n    txEstimationExecutionStatus,\r\n  } = useEstimateTransactionGas({\r\n    txData: txData || '',\r\n    txRecipient,\r\n    operation,\r\n    txAmount: txValue,\r\n    safeTxGas: manualSafeTxGas,\r\n    manualGasPrice,\r\n    manualGasLimit,\r\n  })\r\n\r\n  const [buttonStatus, setButtonStatus] = useEstimationStatus(txEstimationExecutionStatus)\r\n  const [executionApproved, setExecutionApproved] = useState<boolean>(true)\r\n  const doExecute = isExecution && executionApproved\r\n\r\n  // Decode tx data.\r\n  useEffect(() => {\r\n    const decodeTxData = async () => {\r\n      const res = await fetchTxDecoder(txData)\r\n      setDecodedData(res)\r\n    }\r\n\r\n    decodeTxData()\r\n  }, [txData])\r\n\r\n  const handleUserConfirmation = (safeTxHash: string): void => {\r\n    onUserConfirm(safeTxHash, requestId)\r\n    onClose()\r\n  }\r\n\r\n  const confirmTransactions = (txParameters: TxParameters) => {\r\n    setButtonStatus(ButtonStatus.LOADING)\r\n\r\n    dispatch(\r\n      createTransaction(\r\n        {\r\n          safeAddress,\r\n          to: txRecipient,\r\n          valueInWei: txValue,\r\n          txData,\r\n          operation,\r\n          origin: app.id,\r\n          navigateToTransactionsTab: false,\r\n          txNonce: txParameters.safeNonce,\r\n          safeTxGas: txParameters.safeTxGas,\r\n          ethParameters: txParameters,\r\n          notifiedTransaction: TX_NOTIFICATION_TYPES.STANDARD_TX,\r\n          delayExecution: !executionApproved,\r\n        },\r\n        handleUserConfirmation,\r\n        onReject,\r\n      ),\r\n    )\r\n\r\n    setButtonStatus(ButtonStatus.READY)\r\n  }\r\n\r\n  const closeEditModalCallback = (txParameters: TxParameters) => {\r\n    const oldGasPrice = gasPriceFormatted\r\n    const newGasPrice = txParameters.ethGasPrice\r\n    const oldSafeTxGas = gasEstimation\r\n    const newSafeTxGas = txParameters.safeTxGas\r\n\r\n    if (newGasPrice && oldGasPrice !== newGasPrice) {\r\n      setManualGasPrice(txParameters.ethGasPrice)\r\n    }\r\n\r\n    if (txParameters.ethGasLimit && gasLimit !== txParameters.ethGasLimit) {\r\n      setManualGasLimit(txParameters.ethGasLimit)\r\n    }\r\n\r\n    if (newSafeTxGas && oldSafeTxGas !== newSafeTxGas) {\r\n      setManualSafeTxGas(newSafeTxGas)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <EditableTxParameters\r\n      ethGasLimit={gasLimit}\r\n      ethGasPrice={gasPriceFormatted}\r\n      safeTxGas={Math.max(parseInt(gasEstimation), params?.safeTxGas || 0).toString()}\r\n      closeEditModalCallback={closeEditModalCallback}\r\n      isOffChainSignature={isOffChainSignature}\r\n      isExecution={doExecute}\r\n    >\r\n      {(txParameters, toggleEditMode) => (\r\n        <div hidden={hidden}>\r\n          <ModalHeader title={app.name} iconUrl={app.iconUrl} onClose={onReject} />\r\n\r\n          <Hairline />\r\n\r\n          <Container>\r\n            {/* Safe */}\r\n            <PrefixedEthHashInfo name={safeName} hash={safeAddress} showAvatar showCopyBtn explorerUrl={explorerUrl} />\r\n            <StyledBlock>\r\n              <Text size=\"md\">Balance:</Text>\r\n              <Text size=\"md\" strong>{`${ethBalance} ${nativeCurrency.symbol}`}</Text>\r\n            </StyledBlock>\r\n\r\n            <Divider withArrow />\r\n\r\n            {/* Txs decoded */}\r\n            <BasicTxInfo\r\n              txRecipient={txRecipient}\r\n              txData={txData}\r\n              txValue={fromTokenUnit(txValue, nativeCurrency.decimals)}\r\n            />\r\n\r\n            <DecodeTxsWrapper>\r\n              <DecodeTxs txs={txs} decodedData={decodedData} onTxItemClick={showDecodedTxData} />\r\n            </DecodeTxsWrapper>\r\n\r\n            {!isMultiSend && <Divider />}\r\n\r\n            {isExecution && <ExecuteCheckbox onChange={setExecutionApproved} />}\r\n\r\n            {/* Tx Parameters */}\r\n            <TxParametersDetail\r\n              txParameters={txParameters}\r\n              onEdit={toggleEditMode}\r\n              isTransactionCreation={isCreation}\r\n              isTransactionExecution={doExecute}\r\n              isOffChainSignature={isOffChainSignature}\r\n            />\r\n          </Container>\r\n\r\n          {/* Gas info */}\r\n          {txEstimationExecutionStatus === EstimationStatus.LOADING ? null : (\r\n            <ReviewInfoText\r\n              gasCostFormatted={isOwner ? gasCostFormatted : undefined}\r\n              isCreation={isCreation}\r\n              isExecution={doExecute}\r\n              isOffChainSignature={isOffChainSignature}\r\n              safeNonce={txParameters.safeNonce}\r\n              txEstimationExecutionStatus={txEstimationExecutionStatus}\r\n            />\r\n          )}\r\n\r\n          {/* Buttons */}\r\n          <Modal.Footer withoutBorder={txEstimationExecutionStatus !== EstimationStatus.LOADING}>\r\n            <Modal.Footer.Buttons\r\n              cancelButtonProps={{ onClick: onReject }}\r\n              confirmButtonProps={{\r\n                onClick: () => confirmTransactions(txParameters),\r\n                disabled: !isOwner,\r\n                status: buttonStatus,\r\n                text: txEstimationExecutionStatus === EstimationStatus.LOADING ? 'Estimating' : undefined,\r\n              }}\r\n            />\r\n          </Modal.Footer>\r\n        </div>\r\n      )}\r\n    </EditableTxParameters>\r\n  )\r\n}\r\n","import styled from 'styled-components'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Close from '@material-ui/icons/Close'\r\nimport { Icon } from '@gnosis.pm/safe-react-components'\r\n\r\nimport Paragraph from 'src/components/layout/Paragraph'\r\nimport { md, lg } from 'src/theme/variables'\r\nimport Row from 'src/components/layout/Row'\r\n\r\nconst StyledParagraph = styled(Paragraph)`\r\n  && {\r\n    font-size: ${lg};\r\n    white-space: nowrap;\r\n    max-width: 370px;\r\n    overflow: hidden;\r\n  }\r\n`\r\nconst IconImg = styled.img`\r\n  width: 20px;\r\n  margin-right: 10px;\r\n`\r\nconst TitleWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n`\r\n\r\nconst StyledRow = styled(Row)`\r\n  padding: ${md} ${lg};\r\n  justify-content: space-between;\r\n  box-sizing: border-box;\r\n  max-height: 75px;\r\n`\r\n\r\nconst StyledClose = styled(Close)`\r\n  height: 35px;\r\n  width: 35px;\r\n`\r\n\r\nconst GoBackWrapper = styled.div`\r\n  margin-right: 15px;\r\n`\r\n\r\ntype Props = {\r\n  title: string\r\n  goBack?: () => void\r\n  iconUrl?: string\r\n  onClose?: () => void\r\n}\r\n\r\nconst ModalTitle = ({ goBack, iconUrl, title, onClose }: Props): React.ReactElement => {\r\n  return (\r\n    <StyledRow align=\"center\" grow>\r\n      <TitleWrapper>\r\n        {goBack && (\r\n          <GoBackWrapper>\r\n            <IconButton onClick={goBack}>\r\n              <Icon type=\"arrowLeft\" size=\"md\" />\r\n            </IconButton>\r\n          </GoBackWrapper>\r\n        )}\r\n        {iconUrl && <IconImg alt={title} src={iconUrl} />}\r\n        <StyledParagraph noMargin weight=\"bolder\" title={title}>\r\n          {title}\r\n        </StyledParagraph>\r\n      </TitleWrapper>\r\n      <IconButton disableRipple onClick={onClose}>\r\n        <StyledClose />\r\n      </IconButton>\r\n    </StyledRow>\r\n  )\r\n}\r\n\r\nexport default ModalTitle\r\n","import { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\nimport { DecodedDataParameterValue, DecodedDataResponse } from '@gnosis.pm/safe-react-gateway-sdk'\r\n\r\nimport { getNativeCurrency } from 'src/config'\r\nimport { fromTokenUnit } from 'src/logic/tokens/utils/humanReadableValue'\r\nimport { md, lg } from 'src/theme/variables'\r\nimport ModalTitle from 'src/components/ModalTitle'\r\nimport Hairline from 'src/components/layout/Hairline'\r\nimport { BasicTxInfo, getParameterElement } from 'src/components/DecodeTxs'\r\n\r\nconst Container = styled.div`\r\n  max-width: 480px;\r\n  padding: ${md} ${lg};\r\n  word-break: break-word;\r\n`\r\n\r\nfunction isDataDecodedParameterValue(arg: any): arg is DecodedDataParameterValue {\r\n  return arg.operation !== undefined\r\n}\r\n\r\ntype Props = {\r\n  hideDecodedTxData: () => void\r\n  onClose: () => void\r\n  decodedTxData: DecodedDataParameterValue | DecodedDataResponse\r\n}\r\n\r\nexport const DecodedTxDetail = ({ hideDecodedTxData, onClose, decodedTxData: tx }: Props): ReactElement => {\r\n  const nativeCurrency = getNativeCurrency()\r\n  let body\r\n  // If we are dealing with a multiSend\r\n  // decodedTxData is of type DataDecodedParameter\r\n  if (isDataDecodedParameterValue(tx)) {\r\n    const txValue = fromTokenUnit(tx.value, nativeCurrency.decimals)\r\n\r\n    body = (\r\n      <>\r\n        <BasicTxInfo txRecipient={tx.to} txData={tx.data} txValue={txValue} />\r\n        {tx.dataDecoded?.parameters.map((p, index) => getParameterElement(p, index))}\r\n      </>\r\n    )\r\n  } else {\r\n    // If we are dealing with a single tx\r\n    // decodedTxData is of type DecodedData\r\n    body = <>{tx.parameters.map((p, index) => getParameterElement(p, index))}</>\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ModalTitle\r\n        title={(tx as DecodedDataParameterValue).dataDecoded?.method || (tx as DecodedDataResponse).method}\r\n        onClose={onClose}\r\n        goBack={hideDecodedTxData}\r\n      />\r\n\r\n      <Hairline />\r\n\r\n      <Container>{body}</Container>\r\n    </>\r\n  )\r\n}\r\n","import { ReactElement, useState } from 'react'\r\nimport { Transaction } from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport { RequestId } from '@gnosis.pm/safe-apps-sdk'\r\nimport { DecodedDataParameterValue, DecodedDataResponse } from '@gnosis.pm/safe-react-gateway-sdk'\r\n\r\nimport Modal from 'src/components/Modal'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { TransactionParams } from 'src/routes/safe/components/Apps/components/AppFrame'\r\nimport { mustBeEthereumAddress } from 'src/components/forms/validator'\r\nimport { SafeAppLoadError } from './SafeAppLoadError'\r\nimport { ReviewConfirm } from './ReviewConfirm'\r\nimport { DecodedTxDetail } from './DecodedTxDetail'\r\n\r\nexport type ConfirmTxModalProps = {\r\n  isOpen: boolean\r\n  app: SafeApp\r\n  txs: Transaction[]\r\n  params?: TransactionParams\r\n  safeAddress: string\r\n  safeName: string\r\n  requestId: RequestId\r\n  ethBalance: string\r\n  onUserConfirm: (safeTxHash: string, requestId: RequestId) => void\r\n  onTxReject: (requestId: RequestId) => void\r\n  onClose: () => void\r\n}\r\n\r\nconst isTxValid = (t: Transaction): boolean => {\r\n  if (!['string', 'number'].includes(typeof t.value)) {\r\n    return false\r\n  }\r\n\r\n  if (typeof t.value === 'string' && !/^(0x)?[0-9a-f]+$/i.test(t.value)) {\r\n    return false\r\n  }\r\n\r\n  const isAddressValid = mustBeEthereumAddress(t.to) === undefined\r\n  return isAddressValid && !!t.data && typeof t.data === 'string'\r\n}\r\n\r\nexport type DecodedTxDetail = DecodedDataParameterValue | DecodedDataResponse | undefined\r\n\r\nexport const ConfirmTxModal = (props: ConfirmTxModalProps): ReactElement => {\r\n  const [decodedTxDetails, setDecodedTxDetails] = useState<DecodedTxDetail>()\r\n  const invalidTransactions = !props.txs.length || props.txs.some((t) => !isTxValid(t))\r\n\r\n  const showDecodedTxData = setDecodedTxDetails\r\n  const hideDecodedTxData = () => setDecodedTxDetails(undefined)\r\n\r\n  const rejectTransaction = () => {\r\n    props.onClose()\r\n    props.onTxReject(props.requestId)\r\n  }\r\n\r\n  const closeDecodedTxDetail = () => {\r\n    hideDecodedTxData()\r\n    rejectTransaction()\r\n  }\r\n\r\n  if (invalidTransactions) {\r\n    return (\r\n      <Modal description=\"Safe App transaction\" title=\"Safe App transaction\" open={props.isOpen}>\r\n        <SafeAppLoadError {...props} />\r\n      </Modal>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Modal description=\"Safe App transaction\" title=\"Safe App transaction\" open={props.isOpen}>\r\n      {decodedTxDetails && (\r\n        <DecodedTxDetail\r\n          onClose={closeDecodedTxDetail}\r\n          hideDecodedTxData={hideDecodedTxData}\r\n          decodedTxData={decodedTxDetails}\r\n        />\r\n      )}\r\n\r\n      <ReviewConfirm\r\n        {...props}\r\n        onReject={rejectTransaction}\r\n        showDecodedTxData={showDecodedTxData}\r\n        hidden={!!decodedTxDetails}\r\n      />\r\n    </Modal>\r\n  )\r\n}\r\n","import { MutableRefObject, useEffect, useState } from 'react'\r\nimport {\r\n  getSDKVersion,\r\n  SDKMessageEvent,\r\n  MethodToResponse,\r\n  Methods,\r\n  ErrorResponse,\r\n  MessageFormatter,\r\n  RequestId,\r\n} from '@gnosis.pm/safe-apps-sdk'\r\nimport { trackError, Errors } from 'src/logic/exceptions/CodedException'\r\nimport { SafeApp } from './types'\r\n\r\ntype MessageHandler = (\r\n  msg: SDKMessageEvent,\r\n) => void | MethodToResponse[Methods] | ErrorResponse | Promise<MethodToResponse[Methods] | ErrorResponse | void>\r\n\r\ntype LegacyMethods = 'getEnvInfo'\r\ntype SDKMethods = Methods | LegacyMethods\r\n\r\nclass AppCommunicator {\r\n  private iframeRef: MutableRefObject<HTMLIFrameElement | null>\r\n  private handlers = new Map<SDKMethods, MessageHandler>()\r\n  private app: SafeApp\r\n\r\n  constructor(iframeRef: MutableRefObject<HTMLIFrameElement | null>, app: SafeApp) {\r\n    this.iframeRef = iframeRef\r\n    this.app = app\r\n\r\n    window.addEventListener('message', this.handleIncomingMessage)\r\n  }\r\n\r\n  on = (method: SDKMethods, handler: MessageHandler): void => {\r\n    this.handlers.set(method, handler)\r\n  }\r\n\r\n  private isValidMessage = (msg: SDKMessageEvent): boolean => {\r\n    // @ts-expect-error .parent doesn't exist on some possible types\r\n    const sentFromIframe = msg.source.parent === window.parent\r\n    const knownMethod = Object.values(Methods).includes(msg.data.method)\r\n\r\n    return sentFromIframe && knownMethod\r\n  }\r\n\r\n  private canHandleMessage = (msg: SDKMessageEvent): boolean => {\r\n    return Boolean(this.handlers.get(msg.data.method))\r\n  }\r\n\r\n  send = (data: unknown, requestId: RequestId, error = false): void => {\r\n    const sdkVersion = getSDKVersion()\r\n    const msg = error\r\n      ? MessageFormatter.makeErrorResponse(requestId, data as string, sdkVersion)\r\n      : MessageFormatter.makeResponse(requestId, data, sdkVersion)\r\n\r\n    this.iframeRef.current?.contentWindow?.postMessage(msg, '*')\r\n  }\r\n\r\n  handleIncomingMessage = async (msg: SDKMessageEvent): Promise<void> => {\r\n    const validMessage = this.isValidMessage(msg)\r\n    const hasHandler = this.canHandleMessage(msg)\r\n\r\n    if (validMessage && hasHandler) {\r\n      const handler = this.handlers.get(msg.data.method)\r\n      try {\r\n        // @ts-expect-error Handler existence is checked in this.canHandleMessage\r\n        const response = await handler(msg)\r\n\r\n        // If response is not returned, it means the response will be send somewhere else\r\n        if (typeof response !== 'undefined') {\r\n          this.send(response, msg.data.id)\r\n        }\r\n      } catch (err) {\r\n        this.send(err.message, msg.data.id, true)\r\n        trackError(Errors._901, err.message, {\r\n          contexts: {\r\n            safeApp: this.app,\r\n            request: msg.data,\r\n          },\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  clear = (): void => {\r\n    window.removeEventListener('message', this.handleIncomingMessage)\r\n  }\r\n}\r\n\r\nconst useAppCommunicator = (\r\n  iframeRef: MutableRefObject<HTMLIFrameElement | null>,\r\n  app?: SafeApp,\r\n): AppCommunicator | undefined => {\r\n  const [communicator, setCommunicator] = useState<AppCommunicator | undefined>(undefined)\r\n  useEffect(() => {\r\n    let communicatorInstance\r\n    const initCommunicator = (iframeRef: MutableRefObject<HTMLIFrameElement>, app: SafeApp) => {\r\n      communicatorInstance = new AppCommunicator(iframeRef, app)\r\n      setCommunicator(communicatorInstance)\r\n    }\r\n\r\n    if (app) {\r\n      initCommunicator(iframeRef as MutableRefObject<HTMLIFrameElement>, app)\r\n    }\r\n\r\n    return () => {\r\n      communicatorInstance?.clear()\r\n    }\r\n  }, [app, iframeRef])\r\n\r\n  return communicator\r\n}\r\n\r\nexport { useAppCommunicator }\r\n","import { useState, useCallback } from 'react'\r\n\r\ntype StateType = { isOpen: boolean; message: string; requestId: string }\r\n\r\nconst INITIAL_MODAL_STATE: StateType = {\r\n  isOpen: false,\r\n  message: '',\r\n  requestId: '',\r\n}\r\n\r\ntype ReturnType = [StateType, (message: string, requestId: string) => void, () => void]\r\n\r\nexport const useSignMessageModal = (): ReturnType => {\r\n  const [signMessageModalState, setSignMessageModalState] = useState<StateType>(INITIAL_MODAL_STATE)\r\n\r\n  const openSignMessageModal = useCallback((message: string, requestId: string) => {\r\n    setSignMessageModalState({\r\n      ...INITIAL_MODAL_STATE,\r\n      isOpen: true,\r\n      message,\r\n      requestId,\r\n    })\r\n  }, [])\r\n\r\n  const closeSignMessageModal = useCallback(() => {\r\n    setSignMessageModalState(INITIAL_MODAL_STATE)\r\n  }, [])\r\n\r\n  return [signMessageModalState, openSignMessageModal, closeSignMessageModal]\r\n}\r\n","import { Operation } from '@gnosis.pm/safe-react-gateway-sdk'\r\nimport { Icon, Text } from '@gnosis.pm/safe-react-components'\r\nimport MuiTextField from '@material-ui/core/TextField'\r\nimport { ReactElement, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport styled from 'styled-components'\r\n\r\nimport ModalTitle from 'src/components/ModalTitle'\r\nimport { createTransaction } from 'src/logic/safe/store/actions/createTransaction'\r\nimport { TX_NOTIFICATION_TYPES } from 'src/logic/safe/transactions'\r\nimport { getExplorerInfo, getNativeCurrency } from 'src/config'\r\nimport { EstimationStatus, useEstimateTransactionGas } from 'src/logic/hooks/useEstimateTransactionGas'\r\nimport { EditableTxParameters } from 'src/routes/safe/components/Transactions/helpers/EditableTxParameters'\r\nimport { TxParametersDetail } from 'src/routes/safe/components/Transactions/helpers/TxParametersDetail'\r\nimport { lg, md } from 'src/theme/variables'\r\nimport { useEstimationStatus } from 'src/logic/hooks/useEstimationStatus'\r\nimport { TxParameters } from 'src/routes/safe/container/hooks/useTransactionParameters'\r\nimport { BasicTxInfo } from 'src/components/DecodeTxs'\r\nimport Block from 'src/components/layout/Block'\r\nimport Divider from 'src/components/Divider'\r\nimport { SignMessageModalProps } from '.'\r\nimport Hairline from 'src/components/layout/Hairline'\r\nimport { ButtonStatus, Modal } from 'src/components/Modal'\r\nimport { ReviewInfoText } from 'src/components/ReviewInfoText'\r\nimport { grantedSelector } from 'src/routes/safe/container/selector'\r\nimport Paragraph from 'src/components/layout/Paragraph'\r\nimport PrefixedEthHashInfo from 'src/components/PrefixedEthHashInfo'\r\n\r\nconst Container = styled.div`\r\n  max-width: 480px;\r\n  padding: ${md} ${lg} 0;\r\n`\r\n\r\nconst StyledBlock = styled(Block)`\r\n  background-color: ${({ theme }) => theme.colors.separator};\r\n  width: fit-content;\r\n  padding: 5px 10px;\r\n  border-radius: 3px;\r\n  margin: 4px 0 0 40px;\r\n\r\n  display: flex;\r\n\r\n  > :nth-child(1) {\r\n    margin-right: 5px;\r\n  }\r\n`\r\n\r\nconst MessageTextArea = styled(MuiTextField)`\r\n  &.MuiFormControl-root {\r\n    padding-bottom: ${({ theme }) => theme.margin.md};\r\n  }\r\n`\r\n\r\nconst InfoMessage = styled(Paragraph)`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  > span:first-child {\r\n    margin-right: ${({ theme }) => theme.margin.xs};\r\n  }\r\n`\r\n\r\ntype Props = Omit<SignMessageModalProps, 'message' | 'isOpen'> & {\r\n  txData: string\r\n  txRecipient: string\r\n  utf8Message: string\r\n}\r\n\r\nexport const ReviewMessage = ({\r\n  app,\r\n  safeAddress,\r\n  ethBalance,\r\n  safeName,\r\n  onUserConfirm,\r\n  onClose,\r\n  onTxReject,\r\n  requestId,\r\n  utf8Message,\r\n  txData,\r\n  txRecipient,\r\n}: Props): ReactElement => {\r\n  const dispatch = useDispatch()\r\n  const explorerUrl = getExplorerInfo(safeAddress)\r\n  const nativeCurrency = getNativeCurrency()\r\n  const isOwner = useSelector(grantedSelector)\r\n\r\n  const [manualSafeTxGas, setManualSafeTxGas] = useState('0')\r\n  const [manualGasPrice, setManualGasPrice] = useState<string | undefined>()\r\n  const [manualGasLimit, setManualGasLimit] = useState<string | undefined>()\r\n\r\n  const {\r\n    gasLimit,\r\n    gasPriceFormatted,\r\n    gasEstimation,\r\n    isOffChainSignature,\r\n    isCreation,\r\n    isExecution,\r\n    gasCostFormatted,\r\n    txEstimationExecutionStatus,\r\n  } = useEstimateTransactionGas({\r\n    txData: txData || '',\r\n    txRecipient,\r\n    operation: Operation.DELEGATE,\r\n    txAmount: '0',\r\n    safeTxGas: manualSafeTxGas,\r\n    manualGasPrice,\r\n    manualGasLimit,\r\n  })\r\n\r\n  const [buttonStatus, setButtonStatus] = useEstimationStatus(txEstimationExecutionStatus)\r\n\r\n  const handleTxRejection = () => {\r\n    onTxReject(requestId)\r\n    onClose()\r\n  }\r\n\r\n  const handleUserConfirmation = (safeTxHash: string): void => {\r\n    onUserConfirm(safeTxHash, requestId)\r\n    onClose()\r\n  }\r\n\r\n  const confirmTransactions = (txParameters: TxParameters) => {\r\n    setButtonStatus(ButtonStatus.LOADING)\r\n\r\n    dispatch(\r\n      createTransaction(\r\n        {\r\n          safeAddress,\r\n          to: txRecipient,\r\n          valueInWei: '0',\r\n          txData,\r\n          operation: Operation.DELEGATE,\r\n          origin: app.id,\r\n          navigateToTransactionsTab: false,\r\n          txNonce: txParameters.safeNonce,\r\n          safeTxGas: txParameters.safeTxGas,\r\n          ethParameters: txParameters,\r\n          notifiedTransaction: TX_NOTIFICATION_TYPES.STANDARD_TX,\r\n        },\r\n        handleUserConfirmation,\r\n        handleTxRejection,\r\n      ),\r\n    )\r\n\r\n    setButtonStatus(ButtonStatus.READY)\r\n  }\r\n\r\n  const closeEditModalCallback = (txParameters: TxParameters) => {\r\n    const oldGasPrice = gasPriceFormatted\r\n    const newGasPrice = txParameters.ethGasPrice\r\n    const oldSafeTxGas = gasEstimation\r\n    const newSafeTxGas = txParameters.safeTxGas\r\n\r\n    if (newGasPrice && oldGasPrice !== newGasPrice) {\r\n      setManualGasPrice(txParameters.ethGasPrice)\r\n    }\r\n\r\n    if (txParameters.ethGasLimit && gasLimit !== txParameters.ethGasLimit) {\r\n      setManualGasLimit(txParameters.ethGasLimit)\r\n    }\r\n\r\n    if (newSafeTxGas && oldSafeTxGas !== newSafeTxGas) {\r\n      setManualSafeTxGas(newSafeTxGas)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <EditableTxParameters\r\n      ethGasLimit={gasLimit}\r\n      ethGasPrice={gasPriceFormatted}\r\n      safeTxGas={gasEstimation}\r\n      closeEditModalCallback={closeEditModalCallback}\r\n      isOffChainSignature={isOffChainSignature}\r\n      isExecution={isExecution}\r\n    >\r\n      {(txParameters, toggleEditMode) => (\r\n        <div>\r\n          <ModalTitle title={app.name} iconUrl={app.iconUrl} onClose={handleTxRejection} />\r\n\r\n          <Hairline />\r\n\r\n          <Container>\r\n            {/* Safe */}\r\n            <PrefixedEthHashInfo name={safeName} hash={safeAddress} showAvatar showCopyBtn explorerUrl={explorerUrl} />\r\n            <StyledBlock>\r\n              <Text size=\"md\">Balance:</Text>\r\n              <Text size=\"md\" strong>{`${ethBalance} ${nativeCurrency.symbol}`}</Text>\r\n            </StyledBlock>\r\n\r\n            <Divider withArrow />\r\n\r\n            <BasicTxInfo txRecipient={txRecipient} txData={txData} txValue=\"0\" recipientName=\"SignMessageLib\" />\r\n\r\n            <Text size=\"lg\" strong>\r\n              Signing message:\r\n            </Text>\r\n            <MessageTextArea\r\n              rows=\"2\"\r\n              multiline\r\n              disabled\r\n              fullWidth\r\n              label=\"Message to sign\"\r\n              inputProps={{\r\n                type: 'text',\r\n                value: utf8Message,\r\n                name: 'Message to sign',\r\n                onChange: () => {},\r\n                placeholder: '',\r\n              }}\r\n              InputProps={{\r\n                disableUnderline: true,\r\n              }}\r\n            />\r\n            <InfoMessage>\r\n              <Icon size=\"md\" type=\"info\" color=\"warning\" />\r\n              Signing a message with the Gnosis Safe requires a transaction on the blockchain\r\n            </InfoMessage>\r\n\r\n            <TxParametersDetail\r\n              txParameters={txParameters}\r\n              onEdit={toggleEditMode}\r\n              isTransactionCreation={isCreation}\r\n              isTransactionExecution={isExecution}\r\n              isOffChainSignature={isOffChainSignature}\r\n            />\r\n          </Container>\r\n\r\n          {/* Gas info */}\r\n          {txEstimationExecutionStatus === EstimationStatus.LOADING ? null : (\r\n            <ReviewInfoText\r\n              gasCostFormatted={isOwner ? gasCostFormatted : undefined}\r\n              isCreation={isCreation}\r\n              isExecution={isExecution}\r\n              isOffChainSignature={isOffChainSignature}\r\n              safeNonce={txParameters.safeNonce}\r\n              txEstimationExecutionStatus={txEstimationExecutionStatus}\r\n            />\r\n          )}\r\n\r\n          {/* Buttons */}\r\n          <Modal.Footer withoutBorder={txEstimationExecutionStatus !== EstimationStatus.LOADING}>\r\n            <Modal.Footer.Buttons\r\n              cancelButtonProps={{ onClick: handleTxRejection }}\r\n              confirmButtonProps={{\r\n                onClick: () => confirmTransactions(txParameters),\r\n                disabled: !isOwner,\r\n                status: buttonStatus,\r\n                text: txEstimationExecutionStatus === EstimationStatus.LOADING ? 'Estimating' : undefined,\r\n              }}\r\n            />\r\n          </Modal.Footer>\r\n        </div>\r\n      )}\r\n    </EditableTxParameters>\r\n  )\r\n}\r\n","import { RequestId } from '@gnosis.pm/safe-apps-sdk'\r\nimport { ReactElement } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { hexToUtf8, isHexStrict } from 'web3-utils'\r\n\r\nimport { getWeb3ReadOnly } from 'src/logic/wallets/getWeb3'\r\nimport { ZERO_ADDRESS } from 'src/logic/wallets/ethAddresses'\r\nimport { getSignMessageLibContractInstance, getSignMessageLibAddress } from 'src/logic/contracts/safeContracts'\r\nimport Modal from 'src/components/Modal'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { ReviewMessage } from './ReviewMessage'\r\nimport { currentChainId } from 'src/logic/config/store/selectors'\r\n\r\nexport type SignMessageModalProps = {\r\n  isOpen: boolean\r\n  app: SafeApp\r\n  message: string\r\n  safeAddress: string\r\n  safeName: string\r\n  requestId: RequestId\r\n  ethBalance: string\r\n  onUserConfirm: (safeTxHash: string, requestId: RequestId) => void\r\n  onTxReject: (requestId: RequestId) => void\r\n  onClose: () => void\r\n}\r\n\r\nconst convertToHumanReadableMessage = (message: string): string => {\r\n  const isHex = isHexStrict(message.toString())\r\n\r\n  let humanReadableMessage = message\r\n  if (isHex) {\r\n    try {\r\n      humanReadableMessage = hexToUtf8(message)\r\n    } catch (e) {\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  return humanReadableMessage\r\n}\r\n\r\nexport const SignMessageModal = ({ message, isOpen, ...rest }: SignMessageModalProps): ReactElement => {\r\n  const web3 = getWeb3ReadOnly()\r\n  const networkId = useSelector(currentChainId)\r\n  const txRecipient = getSignMessageLibAddress(networkId) || ZERO_ADDRESS\r\n  const txData = getSignMessageLibContractInstance(web3, networkId)\r\n    .methods.signMessage(web3.eth.accounts.hashMessage(message))\r\n    .encodeABI()\r\n\r\n  const readableData = convertToHumanReadableMessage(message)\r\n\r\n  return (\r\n    <Modal description=\"Safe App transaction\" title=\"Safe App transaction\" open={isOpen}>\r\n      <ReviewMessage {...rest} txRecipient={txRecipient} txData={txData} utf8Message={readableData} />\r\n    </Modal>\r\n  )\r\n}\r\n","import { ReactElement, useState, useRef, useCallback, useEffect } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Loader, Card, Title } from '@gnosis.pm/safe-react-components'\r\nimport {\r\n  GetBalanceParams,\r\n  GetTxBySafeTxHashParams,\r\n  MethodToResponse,\r\n  RPCPayload,\r\n  Methods,\r\n  SignMessageParams,\r\n  RequestId,\r\n} from '@gnosis.pm/safe-apps-sdk'\r\n\r\nimport { useSelector } from 'react-redux'\r\nimport { INTERFACE_MESSAGES, Transaction, LowercaseNetworks } from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport Web3 from 'web3'\r\n\r\nimport { currentSafe } from 'src/logic/safe/store/selectors'\r\nimport { getChainInfo, getChainName, getSafeAppsRpcServiceUrl, getTxServiceUrl } from 'src/config'\r\nimport { isSameURL } from 'src/utils/url'\r\nimport { useAnalytics, SAFE_EVENTS } from 'src/utils/googleAnalytics'\r\nimport { LoadingContainer } from 'src/components/LoaderContainer/index'\r\nimport { SAFE_POLLING_INTERVAL } from 'src/utils/constants'\r\nimport { ConfirmTxModal } from './ConfirmTxModal'\r\nimport { useIframeMessageHandler } from '../hooks/useIframeMessageHandler'\r\nimport { getAppInfoFromUrl, getEmptySafeApp } from '../utils'\r\nimport { SafeApp } from '../types'\r\nimport { useAppCommunicator } from '../communicator'\r\nimport { fetchTokenCurrenciesBalances } from 'src/logic/safe/api/fetchTokenCurrenciesBalances'\r\nimport { fetchSafeTransaction } from 'src/logic/safe/transactions/api/fetchSafeTransaction'\r\nimport { logError, Errors } from 'src/logic/exceptions/CodedException'\r\nimport { addressBookEntryName } from 'src/logic/addressBook/store/selectors'\r\nimport { useSignMessageModal } from '../hooks/useSignMessageModal'\r\nimport { SignMessageModal } from './SignMessageModal'\r\n\r\nconst AppWrapper = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  margin: 0 -16px;\r\n`\r\n\r\nconst StyledCard = styled(Card)`\r\n  flex-grow: 1;\r\n  padding: 0;\r\n  border-radius: 0;\r\n`\r\n\r\nconst StyledIframe = styled.iframe<{ isLoading: boolean }>`\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: auto;\r\n  box-sizing: border-box;\r\n  display: ${({ isLoading }) => (isLoading ? 'none' : 'block')};\r\n`\r\n\r\nexport type TransactionParams = {\r\n  safeTxGas?: number\r\n}\r\n\r\ntype ConfirmTransactionModalState = {\r\n  isOpen: boolean\r\n  txs: Transaction[]\r\n  requestId: RequestId\r\n  params?: TransactionParams\r\n}\r\n\r\ntype Props = {\r\n  appUrl: string\r\n}\r\n\r\nconst APP_LOAD_ERROR_TIMEOUT = 30000\r\n\r\nconst INITIAL_CONFIRM_TX_MODAL_STATE: ConfirmTransactionModalState = {\r\n  isOpen: false,\r\n  txs: [],\r\n  requestId: '',\r\n  params: undefined,\r\n}\r\n\r\nconst safeAppWeb3Provider = new Web3.providers.HttpProvider(getSafeAppsRpcServiceUrl(), {\r\n  timeout: 10_000,\r\n})\r\n\r\nconst URL_NOT_PROVIDED_ERROR = 'App url No provided or it is invalid.'\r\nconst APP_LOAD_ERROR = 'There was an error loading the Safe App. There might be a problem with the App provider.'\r\n\r\nconst AppFrame = ({ appUrl }: Props): ReactElement => {\r\n  const { address: safeAddress, ethBalance, owners, threshold } = useSelector(currentSafe)\r\n  const { nativeCurrency, chainId, chainName, shortName } = getChainInfo()\r\n  const safeName = useSelector((state) => addressBookEntryName(state, { address: safeAddress }))\r\n  const { trackEvent } = useAnalytics()\r\n  const iframeRef = useRef<HTMLIFrameElement>(null)\r\n  const [confirmTransactionModal, setConfirmTransactionModal] =\r\n    useState<ConfirmTransactionModalState>(INITIAL_CONFIRM_TX_MODAL_STATE)\r\n  const [appIsLoading, setAppIsLoading] = useState<boolean>(true)\r\n  const [safeApp, setSafeApp] = useState<SafeApp>(() => getEmptySafeApp(appUrl))\r\n  const [signMessageModalState, openSignMessageModal, closeSignMessageModal] = useSignMessageModal()\r\n  const timer = useRef<number>()\r\n  const [isLoadingSlow, setIsLoadingSlow] = useState<boolean>(false)\r\n  const errorTimer = useRef<number>()\r\n  const [, setAppLoadError] = useState<boolean>(false)\r\n\r\n  useEffect(() => {\r\n    const clearTimeouts = () => {\r\n      clearTimeout(timer.current)\r\n      clearTimeout(errorTimer.current)\r\n    }\r\n\r\n    if (appIsLoading) {\r\n      timer.current = window.setTimeout(() => {\r\n        setIsLoadingSlow(true)\r\n      }, SAFE_POLLING_INTERVAL)\r\n      errorTimer.current = window.setTimeout(() => {\r\n        setAppLoadError(() => {\r\n          throw Error(APP_LOAD_ERROR)\r\n        })\r\n      }, APP_LOAD_ERROR_TIMEOUT)\r\n    } else {\r\n      clearTimeouts()\r\n      setIsLoadingSlow(false)\r\n    }\r\n\r\n    return () => {\r\n      clearTimeouts()\r\n    }\r\n  }, [appIsLoading])\r\n\r\n  const openConfirmationModal = useCallback(\r\n    (txs: Transaction[], params: TransactionParams | undefined, requestId: RequestId) =>\r\n      setConfirmTransactionModal({\r\n        isOpen: true,\r\n        txs,\r\n        requestId,\r\n        params,\r\n      }),\r\n    [setConfirmTransactionModal],\r\n  )\r\n  const closeConfirmationModal = useCallback(\r\n    () => setConfirmTransactionModal(INITIAL_CONFIRM_TX_MODAL_STATE),\r\n    [setConfirmTransactionModal],\r\n  )\r\n\r\n  const { sendMessageToIframe } = useIframeMessageHandler(\r\n    safeApp,\r\n    openConfirmationModal,\r\n    closeConfirmationModal,\r\n    iframeRef,\r\n  )\r\n\r\n  const onIframeLoad = useCallback(() => {\r\n    const iframe = iframeRef.current\r\n    if (!iframe || !isSameURL(iframe.src, appUrl as string)) {\r\n      return\r\n    }\r\n\r\n    setAppIsLoading(false)\r\n    sendMessageToIframe({\r\n      messageId: INTERFACE_MESSAGES.ON_SAFE_INFO,\r\n      data: {\r\n        safeAddress: safeAddress as string,\r\n        network: getChainName().toLowerCase() as LowercaseNetworks,\r\n        ethBalance: ethBalance as string,\r\n      },\r\n    })\r\n  }, [ethBalance, safeAddress, appUrl, sendMessageToIframe])\r\n\r\n  const communicator = useAppCommunicator(iframeRef, safeApp)\r\n\r\n  useEffect(() => {\r\n    communicator?.on('getEnvInfo', () => ({\r\n      txServiceUrl: getTxServiceUrl(),\r\n    }))\r\n\r\n    communicator?.on(Methods.getTxBySafeTxHash, async (msg) => {\r\n      const { safeTxHash } = msg.data.params as GetTxBySafeTxHashParams\r\n\r\n      const tx = await fetchSafeTransaction(safeTxHash)\r\n\r\n      return tx\r\n    })\r\n\r\n    communicator?.on(Methods.getSafeInfo, () => ({\r\n      safeAddress,\r\n      network: chainName,\r\n      chainId: parseInt(chainId, 10),\r\n      owners,\r\n      threshold,\r\n    }))\r\n\r\n    communicator?.on(Methods.getSafeBalances, async (msg) => {\r\n      const { currency = 'usd' } = msg.data.params as GetBalanceParams\r\n\r\n      const balances = await fetchTokenCurrenciesBalances({ safeAddress, selectedCurrency: currency })\r\n\r\n      return balances\r\n    })\r\n\r\n    communicator?.on(Methods.rpcCall, async (msg) => {\r\n      const params = msg.data.params as RPCPayload\r\n\r\n      try {\r\n        const response = new Promise<MethodToResponse['rpcCall']>((resolve, reject) => {\r\n          safeAppWeb3Provider.send(\r\n            {\r\n              jsonrpc: '2.0',\r\n              method: params.call,\r\n              params: params.params,\r\n              id: '1',\r\n            },\r\n            (err, res) => {\r\n              if (err || res?.error) {\r\n                reject(err || res?.error)\r\n              }\r\n\r\n              resolve(res?.result)\r\n            },\r\n          )\r\n        })\r\n\r\n        return response\r\n      } catch (err) {\r\n        return err\r\n      }\r\n    })\r\n\r\n    communicator?.on(Methods.sendTransactions, (msg) => {\r\n      // @ts-expect-error explore ways to fix this\r\n      openConfirmationModal(msg.data.params.txs as Transaction[], msg.data.params.params, msg.data.id)\r\n    })\r\n\r\n    communicator?.on(Methods.signMessage, async (msg) => {\r\n      const { message } = msg.data.params as SignMessageParams\r\n\r\n      openSignMessageModal(message, msg.data.id)\r\n    })\r\n\r\n    communicator?.on(Methods.getChainInfo, async () => {\r\n      return {\r\n        chainName,\r\n        chainId,\r\n        shortName,\r\n        nativeCurrency,\r\n      }\r\n    })\r\n  }, [\r\n    communicator,\r\n    openConfirmationModal,\r\n    safeAddress,\r\n    owners,\r\n    threshold,\r\n    openSignMessageModal,\r\n    nativeCurrency,\r\n    chainId,\r\n    chainName,\r\n    shortName,\r\n  ])\r\n\r\n  const onUserTxConfirm = (safeTxHash: string, requestId: RequestId) => {\r\n    // Safe Apps SDK V1 Handler\r\n    sendMessageToIframe(\r\n      { messageId: INTERFACE_MESSAGES.TRANSACTION_CONFIRMED, data: { safeTxHash } },\r\n      confirmTransactionModal.requestId,\r\n    )\r\n\r\n    // Safe Apps SDK V2 Handler\r\n    communicator?.send({ safeTxHash }, requestId as string)\r\n  }\r\n\r\n  const onTxReject = (requestId: RequestId) => {\r\n    // Safe Apps SDK V1 Handler\r\n    sendMessageToIframe(\r\n      { messageId: INTERFACE_MESSAGES.TRANSACTION_REJECTED, data: {} },\r\n      confirmTransactionModal.requestId,\r\n    )\r\n\r\n    // Safe Apps SDK V2 Handler\r\n    communicator?.send('Transaction was rejected', requestId as string, true)\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!appUrl) {\r\n      throw Error(URL_NOT_PROVIDED_ERROR)\r\n    }\r\n\r\n    const loadApp = async () => {\r\n      try {\r\n        const app = await getAppInfoFromUrl(appUrl)\r\n        setSafeApp(app)\r\n      } catch (err) {\r\n        logError(Errors._900, `${appUrl}, ${err.message}`)\r\n      }\r\n    }\r\n\r\n    loadApp()\r\n  }, [appUrl])\r\n\r\n  //track GA\r\n  useEffect(() => {\r\n    if (safeApp) {\r\n      trackEvent({ ...SAFE_EVENTS.SAFE_APP, label: safeApp.name })\r\n    }\r\n  }, [safeApp, trackEvent])\r\n\r\n  return (\r\n    <AppWrapper>\r\n      <StyledCard>\r\n        {appIsLoading && (\r\n          <LoadingContainer style={{ flexDirection: 'column' }}>\r\n            {isLoadingSlow && <Title size=\"xs\">The Safe App is taking too long to load, consider refreshing.</Title>}\r\n            <Loader size=\"md\" />\r\n          </LoadingContainer>\r\n        )}\r\n\r\n        <StyledIframe\r\n          isLoading={appIsLoading}\r\n          frameBorder=\"0\"\r\n          id={`iframe-${appUrl}`}\r\n          ref={iframeRef}\r\n          src={appUrl}\r\n          title={safeApp.name}\r\n          onLoad={onIframeLoad}\r\n        />\r\n      </StyledCard>\r\n\r\n      <ConfirmTxModal\r\n        isOpen={confirmTransactionModal.isOpen}\r\n        app={safeApp as SafeApp}\r\n        safeAddress={safeAddress}\r\n        ethBalance={ethBalance as string}\r\n        safeName={safeName as string}\r\n        txs={confirmTransactionModal.txs}\r\n        onClose={closeConfirmationModal}\r\n        requestId={confirmTransactionModal.requestId}\r\n        onUserConfirm={onUserTxConfirm}\r\n        params={confirmTransactionModal.params}\r\n        onTxReject={onTxReject}\r\n      />\r\n\r\n      <SignMessageModal\r\n        isOpen={signMessageModalState.isOpen}\r\n        app={safeApp as SafeApp}\r\n        safeAddress={safeAddress}\r\n        ethBalance={ethBalance as string}\r\n        safeName={safeName as string}\r\n        onClose={closeSignMessageModal}\r\n        requestId={signMessageModalState.requestId}\r\n        message={signMessageModalState.message}\r\n        onUserConfirm={onUserTxConfirm}\r\n        onTxReject={onTxReject}\r\n      />\r\n    </AppWrapper>\r\n  )\r\n}\r\n\r\nexport default AppFrame\r\n","import { useSnackbar } from 'notistack'\r\nimport {\r\n  InterfaceMessageIds,\r\n  InterfaceMessageToPayload,\r\n  SDKMessageIds,\r\n  SDKMessageToPayload,\r\n  SDK_MESSAGES,\r\n  INTERFACE_MESSAGES,\r\n  RequestId,\r\n  Transaction,\r\n  LowercaseNetworks,\r\n} from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { useEffect, useCallback, MutableRefObject } from 'react'\r\n\r\nimport { getChainName, getTxServiceUrl } from 'src/config/'\r\nimport { currentSafeWithNames } from 'src/logic/safe/store/selectors'\r\nimport { TransactionParams } from '../components/AppFrame'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\n\r\ntype InterfaceMessageProps<T extends InterfaceMessageIds> = {\r\n  messageId: T\r\n  data: InterfaceMessageToPayload[T]\r\n}\r\n\r\ntype ReturnType = {\r\n  sendMessageToIframe: <T extends InterfaceMessageIds>(message: InterfaceMessageProps<T>, requestId?: RequestId) => void\r\n}\r\n\r\nconst useIframeMessageHandler = (\r\n  selectedApp: SafeApp | undefined,\r\n  openConfirmationModal: (txs: Transaction[], params: TransactionParams | undefined, requestId: RequestId) => void,\r\n  closeModal: () => void,\r\n  iframeRef: MutableRefObject<HTMLIFrameElement | null>,\r\n): ReturnType => {\r\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\r\n  const { address: safeAddress, ethBalance, name: safeName } = useSelector(currentSafeWithNames)\r\n  const dispatch = useDispatch()\r\n\r\n  const sendMessageToIframe = useCallback(\r\n    function <T extends InterfaceMessageIds>(message: InterfaceMessageProps<T>, requestId?: RequestId) {\r\n      const requestWithMessage = {\r\n        ...message,\r\n        requestId: requestId || Math.trunc(window.performance.now()),\r\n        version: '0.4.2',\r\n      }\r\n\r\n      if (iframeRef && selectedApp) {\r\n        iframeRef.current?.contentWindow?.postMessage(requestWithMessage, selectedApp.url)\r\n      }\r\n    },\r\n    [iframeRef, selectedApp],\r\n  )\r\n\r\n  useEffect(() => {\r\n    const handleIframeMessage = (\r\n      messageId: SDKMessageIds,\r\n      messagePayload: SDKMessageToPayload[typeof messageId],\r\n      requestId: RequestId,\r\n    ): void => {\r\n      if (!messageId) {\r\n        return\r\n      }\r\n\r\n      switch (messageId) {\r\n        // typescript doesn't narrow type in switch/case statements\r\n        // issue: https://github.com/microsoft/TypeScript/issues/20375\r\n        // possible solution: https://stackoverflow.com/a/43879897/7820085\r\n        case SDK_MESSAGES.SEND_TRANSACTIONS: {\r\n          if (messagePayload) {\r\n            openConfirmationModal(\r\n              messagePayload as SDKMessageToPayload[typeof SDK_MESSAGES.SEND_TRANSACTIONS],\r\n              undefined,\r\n              requestId,\r\n            )\r\n          }\r\n          break\r\n        }\r\n\r\n        case SDK_MESSAGES.SAFE_APP_SDK_INITIALIZED: {\r\n          const safeInfoMessage = {\r\n            messageId: INTERFACE_MESSAGES.ON_SAFE_INFO,\r\n            data: {\r\n              safeAddress: safeAddress as string,\r\n              network: getChainName().toLowerCase() as LowercaseNetworks,\r\n              ethBalance: ethBalance as string,\r\n            },\r\n          }\r\n          const envInfoMessage = {\r\n            messageId: INTERFACE_MESSAGES.ENV_INFO,\r\n            data: {\r\n              txServiceUrl: getTxServiceUrl(),\r\n            },\r\n          }\r\n\r\n          sendMessageToIframe(safeInfoMessage)\r\n          sendMessageToIframe(envInfoMessage)\r\n          break\r\n        }\r\n        default: {\r\n          console.error(`ThirdPartyApp: A message was received with an unknown message id ${messageId}.`)\r\n          break\r\n        }\r\n      }\r\n    }\r\n    const onIframeMessage = async (\r\n      message: MessageEvent<{\r\n        requestId: RequestId\r\n        messageId: SDKMessageIds\r\n        data: SDKMessageToPayload[SDKMessageIds]\r\n      }>,\r\n    ) => {\r\n      if (message.origin === window.origin) {\r\n        return\r\n      }\r\n      if (!selectedApp?.url.includes(message.origin)) {\r\n        console.error(`ThirdPartyApp: A message was received from an unknown origin ${message.origin}`)\r\n        return\r\n      }\r\n      handleIframeMessage(message.data.messageId, message.data.data, message.data.requestId)\r\n    }\r\n\r\n    window.addEventListener('message', onIframeMessage)\r\n    return () => {\r\n      window.removeEventListener('message', onIframeMessage)\r\n    }\r\n  }, [\r\n    closeModal,\r\n    closeSnackbar,\r\n    dispatch,\r\n    enqueueSnackbar,\r\n    ethBalance,\r\n    openConfirmationModal,\r\n    safeAddress,\r\n    safeName,\r\n    selectedApp,\r\n    sendMessageToIframe,\r\n  ])\r\n\r\n  return {\r\n    sendMessageToIframe,\r\n  }\r\n}\r\n\r\nexport { useIframeMessageHandler }\r\n","export default __webpack_public_path__ + \"static/media/addApp.4a0829b7.svg\";","import styled, { keyframes } from 'styled-components'\r\n\r\nconst gradientSK = keyframes`\r\n  0% {\r\n    background-position: 0% 54%;\r\n  }\r\n  50% {\r\n    background-position: 100% 47%;\r\n  }\r\n  100% {\r\n    background-position: 0% 54%;\r\n  }\r\n`\r\n\r\nexport const AppIconSK = styled.div`\r\n  height: 60px;\r\n  width: 60px;\r\n  border-radius: 30px;\r\n  margin: 0 auto;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\nexport const TitleSK = styled.div`\r\n  height: 24px;\r\n  width: 160px;\r\n  margin: 24px auto;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\nexport const DescriptionSK = styled.div`\r\n  height: 16px;\r\n  width: 200px;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\n","import { SyntheticEvent } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Link } from 'react-router-dom'\r\nimport Bookmark from '@material-ui/icons/Bookmark'\r\nimport BookmarkBorder from '@material-ui/icons/BookmarkBorder'\r\nimport { alpha } from '@material-ui/core/styles/colorManipulator'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport { Title, Text, Button, Card, Icon } from '@gnosis.pm/safe-react-components'\r\nimport { motion } from 'framer-motion'\r\nimport AddAppIcon from 'src/routes/safe/components/Apps/assets/addApp.svg'\r\nimport { FETCH_STATUS } from 'src/utils/requests'\r\nimport { SafeApp } from '../../types'\r\n\r\nimport appsIconSvg from 'src/assets/icons/apps.svg'\r\nimport { AppIconSK, DescriptionSK, TitleSK } from './skeleton'\r\n\r\nconst StyledAppCard = styled(Card)`\r\n  display: flex;\r\n  align-items: center;\r\n  flex-direction: column;\r\n  justify-content: space-evenly;\r\n  box-shadow: 1px 2px 10px 0 ${({ theme }) => alpha(theme.colors.shadow.color, 0.18)};\r\n  height: 232px !important;\r\n  box-sizing: border-box;\r\n  cursor: pointer;\r\n  color: ${({ theme }) => theme.colors.secondary};\r\n\r\n  :hover {\r\n    box-shadow: 1px 2px 16px 0 ${({ theme }) => alpha(theme.colors.shadow.color, 0.35)};\r\n    transition: box-shadow 0.3s ease-in-out;\r\n    background-color: ${({ theme }) => theme.colors.background};\r\n    cursor: pointer;\r\n\r\n    h5 {\r\n      color: ${({ theme }) => theme.colors.primary};\r\n    }\r\n  }\r\n`\r\n\r\nconst IconBtn = styled(IconButton)`\r\n  &.MuiButtonBase-root {\r\n    position: absolute;\r\n    top: 10px;\r\n    right: 10px;\r\n    z-index: 10;\r\n    padding: 5px;\r\n    opacity: 0;\r\n\r\n    transition: opacity 0.2s ease-in-out;\r\n  }\r\n\r\n  svg {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n`\r\n\r\nconst AppContainer = styled(motion.div)`\r\n  position: relative;\r\n\r\n  &:hover {\r\n    ${IconBtn} {\r\n      opacity: 1;\r\n    }\r\n  }\r\n`\r\n\r\nconst IconImg = styled.img<{ size: 'md' | 'lg'; src: string | undefined }>`\r\n  width: ${({ size }) => (size === 'md' ? '60px' : '102px')};\r\n  height: ${({ size }) => (size === 'md' ? '60px' : '92px')};\r\n  margin-top: ${({ size }) => (size === 'md' ? '0' : '-16px')};\r\n  object-fit: contain;\r\n`\r\n\r\nconst AppName = styled(Title)`\r\n  text-align: center;\r\n  margin: 16px 0 9px 0;\r\n`\r\n\r\nconst AppDescription = styled(Text)`\r\n  text-align: center;\r\n  height: 72px;\r\n  line-height: 24px;\r\n  overflow: hidden;\r\n  display: -webkit-box;\r\n  -webkit-line-clamp: 3;\r\n  -webkit-box-orient: vertical;\r\n`\r\n\r\nconst StyledLink = styled(Link)`\r\n  text-decoration: none;\r\n`\r\n\r\nconst setAppImageFallback = (error: SyntheticEvent<HTMLImageElement, Event>): void => {\r\n  error.currentTarget.onerror = null\r\n  error.currentTarget.src = appsIconSvg\r\n}\r\n\r\nconst isAppLoading = (app: SafeApp) => FETCH_STATUS.LOADING === app.fetchStatus\r\nconst getPinLabel = (name: string, pinned: boolean) => (pinned ? `Unpin ${name}` : `Pin ${name}`)\r\n\r\ntype Shared = {\r\n  className?: string\r\n  app: SafeApp\r\n  iconSize?: 'md' | 'lg'\r\n  to: string\r\n  pinned?: boolean\r\n}\r\n\r\ntype CustomAppProps = Shared & { onRemove?: (app: SafeApp) => void; onPin?: undefined }\r\ntype RemoteAppProps = Shared & { onPin?: (app: SafeApp) => void; onRemove?: undefined }\r\ntype Props = CustomAppProps | RemoteAppProps\r\n\r\nconst AppCard = ({ app, iconSize = 'md', to, onPin, onRemove, pinned = false }: Props): React.ReactElement => {\r\n  if (isAppLoading(app)) {\r\n    return (\r\n      <AppContainer layout initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>\r\n        <StyledAppCard>\r\n          <AppIconSK />\r\n          <TitleSK />\r\n          <DescriptionSK />\r\n          <DescriptionSK />\r\n        </StyledAppCard>\r\n      </AppContainer>\r\n    )\r\n  }\r\n\r\n  const content = (\r\n    <>\r\n      <StyledAppCard>\r\n        <IconImg alt={`${app.name || 'App'} Logo`} src={app.iconUrl} onError={setAppImageFallback} size={iconSize} />\r\n        <AppName size=\"xs\">{app.name}</AppName>\r\n        <AppDescription size=\"lg\">{app.description} </AppDescription>\r\n      </StyledAppCard>\r\n      {onPin && (\r\n        <IconBtn\r\n          aria-label={getPinLabel(app.name, pinned)}\r\n          title={getPinLabel(app.name, pinned)}\r\n          onClick={(e) => {\r\n            // prevent triggering the link event\r\n            e.preventDefault()\r\n\r\n            onPin(app)\r\n          }}\r\n        >\r\n          {pinned ? <Bookmark /> : <BookmarkBorder />}\r\n        </IconBtn>\r\n      )}\r\n\r\n      {onRemove && (\r\n        <IconBtn\r\n          aria-label=\"Remove an app\"\r\n          title=\"Remove app\"\r\n          onClick={(e) => {\r\n            e.preventDefault()\r\n\r\n            onRemove(app)\r\n          }}\r\n        >\r\n          <Icon size=\"sm\" type=\"delete\" color=\"error\" />\r\n        </IconBtn>\r\n      )}\r\n    </>\r\n  )\r\n\r\n  return (\r\n    <AppContainer layout initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>\r\n      <StyledLink to={to}>{content}</StyledLink>\r\n    </AppContainer>\r\n  )\r\n}\r\n\r\nconst AddCustomAppCard = ({ onClick }: { onClick: () => void }): React.ReactElement => (\r\n  <AppContainer layout initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClick}>\r\n    <StyledAppCard>\r\n      <IconImg alt=\"PlayStation gamepad symbols\" src={AddAppIcon} onError={setAppImageFallback} size=\"lg\" />\r\n      <Button size=\"md\" color=\"primary\" variant=\"contained\" onClick={onClick}>\r\n        Add custom app\r\n      </Button>\r\n    </StyledAppCard>\r\n  </AppContainer>\r\n)\r\n\r\nexport { AppCard, AddCustomAppCard }\r\n","import React from 'react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Input from '@material-ui/core/Input'\r\nimport SearchIcon from '@material-ui/icons/Search'\r\nimport ClearIcon from '@material-ui/icons/Clear'\r\nimport styled from 'styled-components'\r\nimport { Card } from '@gnosis.pm/safe-react-components'\r\n\r\nconst Container = styled(Card)`\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n`\r\n\r\ntype Props = {\r\n  value: string\r\n  onValueChange: (value: string) => void\r\n}\r\n\r\nconst SearchInputCard = ({ value, onValueChange }: Props): React.ReactElement => (\r\n  <Container>\r\n    <Input\r\n      inputProps={{\r\n        'aria-label': 'search',\r\n      }}\r\n      startAdornment={<SearchIcon />}\r\n      endAdornment={\r\n        value && (\r\n          <IconButton aria-label=\"Clear the search\" onClick={() => onValueChange('')}>\r\n            <ClearIcon />\r\n          </IconButton>\r\n        )\r\n      }\r\n      onChange={(event: React.ChangeEvent<HTMLInputElement>) => onValueChange(event.target.value)}\r\n      placeholder=\"e.g Compound\"\r\n      value={value}\r\n      style={{ width: '100%' }}\r\n    />\r\n  </Container>\r\n)\r\n\r\nexport { SearchInputCard }\r\n","import { Text, Button } from '@gnosis.pm/safe-react-components'\r\nimport styled from 'styled-components'\r\n\r\nconst NoAppsFoundTextContainer = styled.div`\r\n  max-width: 650px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-top: ${({ theme }) => theme.margin.xxl};\r\n  margin-bottom: ${({ theme }) => theme.margin.xxl};\r\n\r\n  & > p {\r\n    text-align: center;\r\n  }\r\n`\r\n\r\nconst SButton = styled(Button)`\r\n  margin-top: ${({ theme }) => theme.margin.md};\r\n  max-width: 300px;\r\n`\r\n\r\ntype Props = {\r\n  query: string\r\n  onWalletConnectSearch: () => void\r\n}\r\n\r\nconst NoAppsFound = ({ query, onWalletConnectSearch }: Props): React.ReactElement => (\r\n  <NoAppsFoundTextContainer>\r\n    <Text size=\"xl\">\r\n      No apps found matching <b>{query}</b>. Connect to dApps that haven&apos;t yet been integrated with the Safe using\r\n      the WalletConnect App.\r\n    </Text>\r\n    <SButton onClick={onWalletConnectSearch} size=\"md\">\r\n      Search WalletConnect\r\n    </SButton>\r\n  </NoAppsFoundTextContainer>\r\n)\r\n\r\nexport { NoAppsFound }\r\n","import { Checkbox, Text } from '@gnosis.pm/safe-react-components'\r\n\r\nimport { useFormState } from 'react-final-form'\r\nimport styled from 'styled-components'\r\n\r\nimport { required } from 'src/components/forms/validator'\r\nimport Field from 'src/components/forms/Field'\r\n\r\nconst StyledCheckbox = styled(Checkbox)`\r\n  margin: 0;\r\n`\r\n\r\nconst AppAgreement = (): React.ReactElement => {\r\n  const { visited } = useFormState({ subscription: { visited: true } })\r\n\r\n  // trick to prevent having the field validated by default. Not sure why this happens in this form\r\n  const validate = !visited?.agreementAccepted ? undefined : required\r\n\r\n  return (\r\n    <Field\r\n      component={StyledCheckbox}\r\n      label={<Text size=\"xl\">This app is not a Gnosis product and I agree to use this app at my own risk.</Text>}\r\n      name=\"agreementAccepted\"\r\n      type=\"checkbox\"\r\n      validate={validate}\r\n    />\r\n  )\r\n}\r\n\r\nexport default AppAgreement\r\n","import { useEffect } from 'react'\r\nimport { TextField } from '@gnosis.pm/safe-react-components'\r\nimport createDecorator from 'final-form-calculate'\r\nimport { useField, useFormState } from 'react-final-form'\r\nimport styled from 'styled-components'\r\n\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { getAppInfoFromUrl, getIpfsLinkFromEns, uniqueApp } from 'src/routes/safe/components/Apps/utils'\r\nimport { composeValidators, required } from 'src/components/forms/validator'\r\nimport Field from 'src/components/forms/Field'\r\nimport { isValidURL } from 'src/utils/url'\r\nimport { isValidEnsName } from 'src/logic/wallets/ethAddresses'\r\nimport { useDebounce } from 'src/logic/hooks/useDebounce'\r\n\r\nconst validateUrl = (url: string): string | undefined => (isValidURL(url) ? undefined : 'Invalid URL')\r\n\r\nexport const appUrlResolver = createDecorator({\r\n  field: 'appUrl',\r\n  updates: {\r\n    appUrl: async (appUrl: string): Promise<string | undefined> => {\r\n      const ensContent = !isValidURL(appUrl) && isValidEnsName(appUrl) && (await getIpfsLinkFromEns(appUrl))\r\n\r\n      if (ensContent) {\r\n        return ensContent\r\n      }\r\n\r\n      return appUrl\r\n    },\r\n  },\r\n})\r\n\r\ntype AppInfoUpdaterProps = {\r\n  onAppInfo: (appInfo: SafeApp) => unknown\r\n  onLoading: (isLoading: boolean) => unknown\r\n  onError: (error: Error) => unknown\r\n}\r\n\r\nexport const AppInfoUpdater = ({ onAppInfo, onLoading, onError }: AppInfoUpdaterProps): null => {\r\n  const {\r\n    input: { value: appUrl },\r\n  } = useField('appUrl', { subscription: { value: true } })\r\n\r\n  const debouncedValue = useDebounce(appUrl, 500)\r\n\r\n  useEffect(() => {\r\n    const updateAppInfo = async () => {\r\n      onLoading(true)\r\n\r\n      try {\r\n        const appInfo = await getAppInfoFromUrl(debouncedValue)\r\n        onAppInfo({ ...appInfo })\r\n      } catch (error) {\r\n        onError?.(error)\r\n      }\r\n\r\n      onLoading(false)\r\n    }\r\n\r\n    if (isValidURL(debouncedValue)) {\r\n      updateAppInfo()\r\n    }\r\n  }, [debouncedValue, onAppInfo, onError, onLoading])\r\n\r\n  return null\r\n}\r\n\r\nconst StyledAppUrlField = styled(Field)`\r\n  && {\r\n    width: 100%;\r\n  }\r\n`\r\n\r\nconst AppUrl = ({ appList }: { appList: SafeApp[] }): React.ReactElement => {\r\n  const { visited } = useFormState({ subscription: { visited: true } })\r\n\r\n  // trick to prevent having the field validated by default. Not sure why this happens in this form\r\n  const validate = !visited?.appUrl ? undefined : composeValidators(required, validateUrl, uniqueApp(appList))\r\n\r\n  return (\r\n    <StyledAppUrlField\r\n      label=\"App URL\"\r\n      name=\"appUrl\"\r\n      placeholder=\"App URL\"\r\n      type=\"text\"\r\n      component={TextField}\r\n      validate={validate}\r\n      autoComplete=\"off\"\r\n    />\r\n  )\r\n}\r\n\r\nexport default AppUrl\r\n","import { ReactElement, useMemo } from 'react'\r\nimport { useFormState } from 'react-final-form'\r\n\r\nimport { Modal } from 'src/components/Modal'\r\nimport { isAppManifestValid } from 'src/routes/safe/components/Apps/utils'\r\nimport { SafeApp } from '../../types'\r\n\r\ninterface Props {\r\n  appInfo: SafeApp\r\n  onCancel: () => void\r\n}\r\n\r\nexport const FormButtons = ({ appInfo, onCancel }: Props): ReactElement => {\r\n  const { valid, validating, visited } = useFormState({\r\n    subscription: { valid: true, validating: true, visited: true },\r\n  })\r\n\r\n  const isSubmitDisabled = useMemo(() => {\r\n    // if non visited, fields were not evaluated yet. Then, the default value is considered invalid\r\n    const fieldsVisited = visited?.agreementAccepted && visited?.appUrl\r\n\r\n    // @ts-expect-error adding this because isAppManifestValid only checks name and description which are both present in the SafeApp type\r\n    return validating || !valid || !fieldsVisited || !isAppManifestValid(appInfo)\r\n  }, [validating, valid, visited, appInfo])\r\n\r\n  return (\r\n    <Modal.Footer.Buttons\r\n      cancelButtonProps={{ onClick: onCancel }}\r\n      confirmButtonProps={{ disabled: isSubmitDisabled, text: 'Add' }}\r\n    />\r\n  )\r\n}\r\n","import { Icon, Link, Loader, Text, TextField } from '@gnosis.pm/safe-react-components'\r\nimport { useState, ReactElement, useCallback, useEffect } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport styled from 'styled-components'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\n\r\nimport GnoForm from 'src/components/forms/GnoForm'\r\nimport Img from 'src/components/layout/Img'\r\nimport { Modal } from 'src/components/Modal'\r\nimport AppAgreement from './AppAgreement'\r\nimport AppUrl, { AppInfoUpdater, appUrlResolver } from './AppUrl'\r\nimport { FormButtons } from './FormButtons'\r\nimport { getEmptySafeApp } from 'src/routes/safe/components/Apps/utils'\r\nimport { Errors, logError } from 'src/logic/exceptions/CodedException'\r\nimport { generateSafeRoute, extractPrefixedSafeAddress, SAFE_ROUTES } from 'src/routes/routes'\r\n\r\nconst FORM_ID = 'add-apps-form'\r\n\r\nconst StyledTextFileAppName = styled(TextField)`\r\n  && {\r\n    width: 385px;\r\n  }\r\n`\r\n\r\nconst AppInfo = styled.div`\r\n  display: flex;\r\n  margin: 36px 0 24px 0;\r\n\r\n  img {\r\n    margin-right: 10px;\r\n  }\r\n`\r\n\r\nconst StyledLink = styled(Link)`\r\n  inline-size: fit-content;\r\n`\r\n\r\nconst AppDocsInfo = styled.div`\r\n  display: flex;\r\n  margin-bottom: 24px;\r\n  flex-direction: column;\r\n  svg {\r\n    position: relative;\r\n    top: 4px;\r\n    left: 4px;\r\n  }\r\n`\r\n\r\nconst WrapperLoader = styled.div`\r\n  height: 55px;\r\n  width: 65px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst StyledLoader = styled(Loader)`\r\n  margin-right: 15px;\r\n`\r\n\r\ninterface AddAppFormValues {\r\n  appUrl: string\r\n  agreementAccepted: boolean\r\n}\r\n\r\nconst INITIAL_VALUES: AddAppFormValues = {\r\n  appUrl: '',\r\n  agreementAccepted: false,\r\n}\r\n\r\nconst DEFAULT_APP_INFO = getEmptySafeApp()\r\n\r\nconst CUSTOM_SAFE_APPS_LINK = 'https://docs.gnosis-safe.io/build/sdks/safe-apps'\r\n\r\ninterface AddAppProps {\r\n  appList: SafeApp[]\r\n  closeModal: () => void\r\n  onAddApp: (app: SafeApp) => void\r\n}\r\n\r\nconst AddApp = ({ appList, closeModal, onAddApp }: AddAppProps): ReactElement => {\r\n  const [appInfo, setAppInfo] = useState<SafeApp>(DEFAULT_APP_INFO)\r\n  const [fetchError, setFetchError] = useState<string | undefined>()\r\n  const history = useHistory()\r\n  const [isLoading, setIsLoading] = useState(false)\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    onAddApp(appInfo)\r\n    history.push({\r\n      pathname: generateSafeRoute(SAFE_ROUTES.APPS, extractPrefixedSafeAddress()),\r\n      search: `?appUrl=${encodeURIComponent(appInfo.url)}`,\r\n    })\r\n  }, [history, appInfo, onAddApp])\r\n\r\n  useEffect(() => {\r\n    if (isLoading) {\r\n      setFetchError(undefined)\r\n    }\r\n  }, [isLoading])\r\n\r\n  const onError = useCallback(\r\n    (error: Error) => {\r\n      setFetchError(error.message)\r\n      logError(Errors._903, error.message)\r\n      setAppInfo(DEFAULT_APP_INFO)\r\n    },\r\n    [setAppInfo],\r\n  )\r\n\r\n  return (\r\n    <GnoForm decorators={[appUrlResolver]} initialValues={INITIAL_VALUES} onSubmit={handleSubmit} testId={FORM_ID}>\r\n      {() => (\r\n        <>\r\n          <Modal.Body>\r\n            <AppDocsInfo>\r\n              <Text size=\"xl\" as=\"span\" color=\"secondary\">\r\n                Safe Apps are third-party extensions.\r\n              </Text>\r\n              <StyledLink\r\n                href={CUSTOM_SAFE_APPS_LINK}\r\n                target=\"_blank\"\r\n                rel=\"noreferrer\"\r\n                title=\"Learn more about building Safe Apps\"\r\n              >\r\n                <Text size=\"xl\" as=\"span\" color=\"primary\">\r\n                  Learn more about building Safe Apps.\r\n                </Text>\r\n                <Icon size=\"sm\" type=\"externalLink\" color=\"primary\" />\r\n              </StyledLink>\r\n            </AppDocsInfo>\r\n            <AppUrl appList={appList} />\r\n            {/* Fetch app from url and return a SafeApp */}\r\n            <AppInfoUpdater onAppInfo={setAppInfo} onLoading={setIsLoading} onError={onError} />\r\n            <AppInfo>\r\n              {isLoading ? (\r\n                <WrapperLoader>\r\n                  <StyledLoader size=\"sm\" />\r\n                </WrapperLoader>\r\n              ) : (\r\n                <Img alt=\"Token image\" width={55} src={appInfo.iconUrl} />\r\n              )}\r\n              <StyledTextFileAppName\r\n                label=\"App name\"\r\n                readOnly\r\n                meta={{ error: fetchError }}\r\n                value={isLoading ? 'Loading...' : appInfo.name === DEFAULT_APP_INFO.name ? '' : appInfo.name}\r\n                onChange={() => {}}\r\n              />\r\n            </AppInfo>\r\n            <AppAgreement />\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <FormButtons appInfo={appInfo} onCancel={closeModal} />\r\n          </Modal.Footer>\r\n        </>\r\n      )}\r\n    </GnoForm>\r\n  )\r\n}\r\n\r\nexport default AddApp\r\n","import { getSafeApps, SafeAppData } from '@gnosis.pm/safe-react-gateway-sdk'\r\n\r\nimport { _getChainId } from 'src/config'\r\nimport { GATEWAY_URL } from 'src/utils/constants'\r\n\r\nexport const fetchSafeAppsList = async (): Promise<SafeAppData[]> => {\r\n  return getSafeApps(GATEWAY_URL, _getChainId())\r\n}\r\n","import { useCallback, useMemo } from 'react'\r\n\r\nimport { SafeApp } from '../../types'\r\nimport { useCustomSafeApps } from './useCustomSafeApps'\r\nimport { useRemoteSafeApps } from './useRemoteSafeApps'\r\nimport { usePinnedSafeApps } from './usePinnedSafeApps'\r\nimport { FETCH_STATUS } from 'src/utils/requests'\r\nimport { SAFE_APP_EVENTS, useAnalytics } from 'src/utils/googleAnalytics'\r\n\r\ntype UseAppListReturnType = {\r\n  allApps: SafeApp[]\r\n  appList: SafeApp[]\r\n  customApps: SafeApp[]\r\n  pinnedSafeApps: SafeApp[]\r\n  togglePin: (app: SafeApp) => void\r\n  removeApp: (appId: string) => void\r\n  addCustomApp: (app: SafeApp) => void\r\n  isLoading: boolean\r\n}\r\n\r\nconst useAppList = (): UseAppListReturnType => {\r\n  const { remoteSafeApps, status: remoteAppsFetchStatus } = useRemoteSafeApps()\r\n  const { customSafeApps, updateCustomSafeApps } = useCustomSafeApps()\r\n  const { pinnedSafeAppIds, updatePinnedSafeApps } = usePinnedSafeApps(remoteSafeApps, remoteAppsFetchStatus)\r\n  const remoteIsLoading = remoteAppsFetchStatus === FETCH_STATUS.LOADING\r\n\r\n  const { trackEvent } = useAnalytics()\r\n\r\n  const allApps = useMemo(() => {\r\n    const allApps = [...remoteSafeApps, ...customSafeApps]\r\n    return allApps.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()))\r\n  }, [remoteSafeApps, customSafeApps])\r\n\r\n  const appList = useMemo(() => {\r\n    return remoteSafeApps.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()))\r\n  }, [remoteSafeApps])\r\n\r\n  const customApps = useMemo(\r\n    () =>\r\n      // Filter out custom apps that are now part of the production app list\r\n      customSafeApps\r\n        .filter((persistedApp) => !remoteSafeApps.some((app) => app.url === persistedApp.url))\r\n        .sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase())),\r\n    [customSafeApps, remoteSafeApps],\r\n  )\r\n\r\n  const pinnedSafeApps = useMemo(\r\n    () => appList.filter((app) => pinnedSafeAppIds.includes(app.id)),\r\n    [pinnedSafeAppIds, appList],\r\n  )\r\n\r\n  const addCustomApp = useCallback(\r\n    (app: SafeApp): void => {\r\n      const newList = [...customSafeApps, app]\r\n      updateCustomSafeApps(newList)\r\n    },\r\n    [updateCustomSafeApps, customSafeApps],\r\n  )\r\n\r\n  const removeApp = useCallback(\r\n    (appId: string): void => {\r\n      const newPersistedList = customSafeApps.filter(({ id }) => id !== appId)\r\n      updateCustomSafeApps(newPersistedList)\r\n    },\r\n    [updateCustomSafeApps, customSafeApps],\r\n  )\r\n\r\n  const togglePin = useCallback(\r\n    (app: SafeApp): void => {\r\n      const { id: appId, name: appName } = app\r\n      const newPinnedIds = [...pinnedSafeAppIds]\r\n      const isAppPinned = pinnedSafeAppIds.includes(appId)\r\n\r\n      if (isAppPinned) {\r\n        trackEvent({ ...SAFE_APP_EVENTS.PIN, label: appName })\r\n        newPinnedIds.splice(newPinnedIds.indexOf(appId), 1)\r\n      } else {\r\n        trackEvent({ ...SAFE_APP_EVENTS.UNPIN, label: appName })\r\n        newPinnedIds.push(appId)\r\n      }\r\n\r\n      updatePinnedSafeApps(newPinnedIds)\r\n    },\r\n    [trackEvent, updatePinnedSafeApps, pinnedSafeAppIds],\r\n  )\r\n\r\n  return {\r\n    allApps,\r\n    appList,\r\n    customApps,\r\n    pinnedSafeApps,\r\n    removeApp,\r\n    togglePin,\r\n    addCustomApp,\r\n    isLoading: remoteIsLoading,\r\n  }\r\n}\r\n\r\nexport { useAppList }\r\n","import { useState, useEffect } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { logError, Errors } from 'src/logic/exceptions/CodedException'\r\nimport enqueueSnackbar from 'src/logic/notifications/store/actions/enqueueSnackbar'\r\nimport { NOTIFICATIONS } from 'src/logic/notifications'\r\nimport { FETCH_STATUS } from 'src/utils/requests'\r\nimport { SafeApp } from '../../types'\r\nimport { fetchSafeAppsList } from 'src/logic/safe/api/fetchSafeApps'\r\n\r\ntype ReturnType = {\r\n  remoteSafeApps: SafeApp[]\r\n  status: FETCH_STATUS\r\n}\r\n\r\nconst useRemoteSafeApps = (): ReturnType => {\r\n  const [remoteSafeApps, setRemoteSafeApps] = useState<SafeApp[]>([])\r\n  const [status, setStatus] = useState<FETCH_STATUS>(FETCH_STATUS.NOT_ASKED)\r\n  const dispatch = useDispatch()\r\n\r\n  useEffect(() => {\r\n    const loadAppsList = async () => {\r\n      setStatus(FETCH_STATUS.LOADING)\r\n      try {\r\n        const result = await fetchSafeAppsList()\r\n\r\n        if (result?.length) {\r\n          setRemoteSafeApps(result.map((app) => ({ ...app, fetchStatus: FETCH_STATUS.SUCCESS, id: String(app.id) })))\r\n          setStatus(FETCH_STATUS.SUCCESS)\r\n        } else {\r\n          throw new Error('Empty apps array ')\r\n        }\r\n      } catch (e) {\r\n        setStatus(FETCH_STATUS.ERROR)\r\n        logError(Errors._902, e.message)\r\n        dispatch(enqueueSnackbar(NOTIFICATIONS.SAFE_APPS_FETCH_ERROR_MSG))\r\n      }\r\n    }\r\n\r\n    loadAppsList()\r\n  }, [dispatch])\r\n\r\n  return { remoteSafeApps, status }\r\n}\r\n\r\nexport { useRemoteSafeApps }\r\n","import { useState, useEffect, useCallback } from 'react'\r\nimport { loadFromStorage, saveToStorage } from 'src/utils/storage'\r\nimport { logError, Errors } from 'src/logic/exceptions/CodedException'\r\nimport { FETCH_STATUS } from 'src/utils/requests'\r\nimport { APPS_STORAGE_KEY, getAppInfoFromUrl, getEmptySafeApp } from '../../utils'\r\nimport { StoredSafeApp, SafeApp } from '../../types'\r\n\r\ntype ReturnType = {\r\n  customSafeApps: SafeApp[]\r\n  loaded: boolean\r\n  updateCustomSafeApps: (newCustomSafeApps: SafeApp[]) => void\r\n}\r\n\r\ntype CustomSafeApp = StoredSafeApp\r\n\r\n/* \r\n  This hook is used to manage the list of custom safe apps.\r\n  What it does:\r\n  1. Loads a list of custom safe apps from local storage\r\n  2. Does some backward compatibility checks (supported app networks, etc)\r\n  3. Tries to fetch the app info (manifest.json) from the app url\r\n*/\r\nconst useCustomSafeApps = (): ReturnType => {\r\n  const [customSafeApps, setCustomSafeApps] = useState<SafeApp[]>([])\r\n  const [loaded, setLoaded] = useState(false)\r\n\r\n  const updateCustomSafeApps = useCallback((newCustomSafeApps: SafeApp[]) => {\r\n    setCustomSafeApps(newCustomSafeApps)\r\n    saveToStorage(\r\n      APPS_STORAGE_KEY,\r\n      newCustomSafeApps.map(({ url }) => ({ url })),\r\n    )\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const fetchAppCallback = (res: SafeApp, error = false) => {\r\n      setCustomSafeApps((prev) => {\r\n        const prevAppsCopy = [...prev]\r\n        const appIndex = prevAppsCopy.findIndex((a) => a.url === res.url)\r\n\r\n        if (error) {\r\n          prevAppsCopy.splice(appIndex, 1)\r\n        } else {\r\n          prevAppsCopy[appIndex] = { ...res, fetchStatus: FETCH_STATUS.SUCCESS }\r\n        }\r\n\r\n        return prevAppsCopy\r\n      })\r\n    }\r\n\r\n    const loadCustomApps = async () => {\r\n      // recover apps from storage (third-party apps added by the user)\r\n      const storageAppList = (await loadFromStorage<CustomSafeApp[]>(APPS_STORAGE_KEY)) || []\r\n      // if the app does not expose supported networks, include them. (backward compatible)\r\n      const serializedApps = storageAppList.map(\r\n        (app): SafeApp => ({\r\n          ...getEmptySafeApp(),\r\n          ...app,\r\n          url: app.url.trim(),\r\n          id: app.url.trim(),\r\n          custom: true,\r\n        }),\r\n      )\r\n      setCustomSafeApps(serializedApps)\r\n      setLoaded(true)\r\n\r\n      serializedApps.forEach((app) => {\r\n        getAppInfoFromUrl(app.url)\r\n          .then((appFromUrl) => {\r\n            fetchAppCallback({ ...appFromUrl, custom: true })\r\n          })\r\n          .catch((err) => {\r\n            fetchAppCallback(app, true)\r\n            logError(Errors._900, `${app.url}, ${err.message}`)\r\n          })\r\n      })\r\n    }\r\n\r\n    loadCustomApps()\r\n  }, [])\r\n\r\n  return { customSafeApps, loaded, updateCustomSafeApps }\r\n}\r\n\r\nexport { useCustomSafeApps }\r\n","import { useState, useEffect } from 'react'\r\nimport { loadFromStorage, saveToStorage } from 'src/utils/storage'\r\nimport { PINNED_SAFE_APP_IDS } from '../../utils'\r\nimport { FETCH_STATUS } from 'src/utils/requests'\r\nimport { SafeApp } from '../../types'\r\n\r\ntype ReturnType = {\r\n  pinnedSafeAppIds: string[]\r\n  loaded: boolean\r\n  updatePinnedSafeApps: (newPinnedSafeAppIds: string[]) => void\r\n}\r\n\r\nconst usePinnedSafeApps = (remoteSafeApps: SafeApp[], remoteAppsFetchStatus: FETCH_STATUS): ReturnType => {\r\n  const [pinnedSafeAppIds, updatePinnedSafeApps] = useState<string[]>([])\r\n  const [loaded, setLoaded] = useState(false)\r\n\r\n  useEffect(() => {\r\n    const loadPinnedAppIds = async () => {\r\n      const pinnedAppIds = (await loadFromStorage<string[]>(PINNED_SAFE_APP_IDS)) || []\r\n\r\n      const isRemoteSafeAppsListLoaded = remoteAppsFetchStatus === FETCH_STATUS.SUCCESS\r\n      if (isRemoteSafeAppsListLoaded) {\r\n        // we remove pinned Safe Apps that are not included in the remote list, see #2847\r\n        const filteredPinnedAppsIds = pinnedAppIds.filter((pinnedAppId) =>\r\n          remoteSafeApps.some((app) => app.id === pinnedAppId),\r\n        )\r\n        updatePinnedSafeApps(filteredPinnedAppsIds)\r\n        setLoaded(true)\r\n      }\r\n    }\r\n\r\n    loadPinnedAppIds()\r\n  }, [remoteAppsFetchStatus, remoteSafeApps])\r\n\r\n  // we only update pinned apps in the localStorage when remote Apps are loaded\r\n  useEffect(() => {\r\n    const isRemoteSafeAppsListLoaded = remoteAppsFetchStatus === FETCH_STATUS.SUCCESS\r\n    if (isRemoteSafeAppsListLoaded) {\r\n      saveToStorage(PINNED_SAFE_APP_IDS, pinnedSafeAppIds)\r\n    }\r\n  }, [pinnedSafeAppIds, remoteAppsFetchStatus])\r\n\r\n  return { pinnedSafeAppIds, loaded, updatePinnedSafeApps }\r\n}\r\n\r\nexport { usePinnedSafeApps }\r\n","import { Text } from '@gnosis.pm/safe-react-components'\r\nimport Card from '@material-ui/core/Card'\r\nimport BookmarkBorder from '@material-ui/icons/BookmarkBorder'\r\n\r\nimport styled from 'styled-components'\r\nimport InfoIcon from 'src/assets/icons/info.svg'\r\nimport Img from 'src/components/layout/Img'\r\n\r\nconst NoAppsFoundTextContainer = styled(Card)`\r\n  display: flex;\r\n  margin-top: ${({ theme }) => theme.margin.md};\r\n  margin-bottom: ${({ theme }) => theme.margin.md};\r\n  box-shadow: 1px 2px 10px 0 rgba(212, 212, 211, 0.59);\r\n  box-sizing: border-box;\r\n  max-width: 100%;\r\n  padding: 52px 54px;\r\n  justify-content: center;\r\n  gap: ${({ theme }) => theme.margin.sm};\r\n`\r\n\r\nconst StyledBookmarkIcon = styled(BookmarkBorder)`\r\n  height: 16px;\r\n  vertical-align: middle;\r\n`\r\n\r\nconst PinnedAppsTutorial = (): React.ReactElement => (\r\n  <NoAppsFoundTextContainer>\r\n    <Img alt=\"Info\" src={InfoIcon} />\r\n    <Text size=\"xl\">\r\n      Simply hover over an app and click on the\r\n      <StyledBookmarkIcon />\r\n      to bookmark the app here for convenient access\r\n    </Text>\r\n  </NoAppsFoundTextContainer>\r\n)\r\n\r\nexport { PinnedAppsTutorial }\r\n","import { IconText, Loader, Menu, Text, Breadcrumb, BreadcrumbElement } from '@gnosis.pm/safe-react-components'\r\nimport { useState } from 'react'\r\nimport styled, { css } from 'styled-components'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\n\r\nimport Collapse from 'src/components/Collapse'\r\nimport Col from 'src/components/layout/Col'\r\nimport { Modal } from 'src/components/Modal'\r\nimport { AppCard, AddCustomAppCard } from 'src/routes/safe/components/Apps/components/AppCard'\r\nimport { useStateHandler } from 'src/logic/hooks/useStateHandler'\r\nimport { SearchInputCard } from './SearchInputCard'\r\nimport { NoAppsFound } from './NoAppsFound'\r\nimport { SafeApp } from '../types'\r\nimport AddAppForm from './AddAppForm'\r\nimport { useAppList } from '../hooks/appList/useAppList'\r\nimport { useAppsSearch } from '../hooks/useAppsSearch'\r\nimport { generateSafeRoute, extractSafeAddress, SAFE_ROUTES } from 'src/routes/routes'\r\nimport { getShortName } from 'src/config'\r\nimport { PinnedAppsTutorial } from './PinnedAppsTutorial'\r\n\r\nexport const PINNED_APPS_LIST_TEST_ID = 'safe_apps__pinned-apps-container'\r\nexport const ALL_APPS_LIST_TEST_ID = 'safe_apps__all-apps-container'\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`\r\n\r\nconst centerCSS = css`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst LoadingContainer = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  ${centerCSS};\r\n`\r\n\r\nconst CardsWrapper = styled(motion.div)`\r\n  width: 100%;\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(243px, 1fr));\r\n  column-gap: 20px;\r\n  row-gap: 20px;\r\n  justify-content: space-evenly;\r\n`\r\n\r\nconst ContentWrapper = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  flex-grow: 1;\r\n  align-items: center;\r\n`\r\n\r\nconst SectionHeading = styled(Text)`\r\n  width: 100%;\r\n  margin: ${({ theme }) => `${theme.margin.xl} 0 ${theme.margin.md} 0`};\r\n`\r\n\r\nconst CenterIconText = styled(IconText)`\r\n  justify-content: center;\r\n  margin: 16px 55px 20px 0;\r\n`\r\n\r\nconst AppsList = (): React.ReactElement => {\r\n  const safeAddress = extractSafeAddress()\r\n  const appsPath = generateSafeRoute(SAFE_ROUTES.APPS, {\r\n    shortName: getShortName(),\r\n    safeAddress,\r\n  })\r\n  const [appSearch, setAppSearch] = useState('')\r\n  const { allApps, appList, removeApp, isLoading, pinnedSafeApps, togglePin, customApps, addCustomApp } = useAppList()\r\n  const apps = useAppsSearch(appList, appSearch)\r\n  const [appToRemove, setAppToRemove] = useState<SafeApp | null>(null)\r\n  const { open: isAddAppModalOpen, toggle: openAddAppModal, clickAway: closeAddAppModal } = useStateHandler()\r\n  const noAppsFound = apps.length === 0 && appSearch\r\n  const showCustomApps = !!customApps.length && !appSearch\r\n  const showPinnedApps = !appSearch\r\n\r\n  const handleAppPin = (app: SafeApp) => {\r\n    togglePin(app)\r\n  }\r\n\r\n  if (isLoading || !safeAddress) {\r\n    return (\r\n      <LoadingContainer>\r\n        <Loader size=\"md\" />\r\n      </LoadingContainer>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Menu>\r\n        <Col start=\"sm\" xs={12}>\r\n          <Breadcrumb>\r\n            <BreadcrumbElement iconType=\"apps\" text=\"Apps\" />\r\n          </Breadcrumb>\r\n        </Col>\r\n      </Menu>\r\n      <ContentWrapper>\r\n        <SearchInputCard value={appSearch} onValueChange={(value) => setAppSearch(value.replace(/\\s{2,}/g, ' '))} />\r\n\r\n        {showPinnedApps && (\r\n          <Collapse\r\n            title={\r\n              <Text color=\"placeHolder\" strong size=\"md\">\r\n                BOOKMARKED APPS\r\n              </Text>\r\n            }\r\n            defaultExpanded\r\n          >\r\n            {pinnedSafeApps.length === 0 && <PinnedAppsTutorial />}\r\n            <AnimatePresence>\r\n              <CardsWrapper data-testid={PINNED_APPS_LIST_TEST_ID}>\r\n                {pinnedSafeApps.map((a) => (\r\n                  <AppCard\r\n                    to={`${appsPath}?appUrl=${encodeURI(a.url)}`}\r\n                    key={a.id}\r\n                    app={a}\r\n                    pinned\r\n                    onPin={handleAppPin}\r\n                  />\r\n                ))}\r\n              </CardsWrapper>\r\n            </AnimatePresence>\r\n          </Collapse>\r\n        )}\r\n\r\n        {showCustomApps && (\r\n          <Collapse\r\n            title={\r\n              <Text color=\"placeHolder\" strong size=\"md\">\r\n                CUSTOM APPS\r\n              </Text>\r\n            }\r\n            defaultExpanded\r\n          >\r\n            <AnimatePresence>\r\n              <CardsWrapper>\r\n                {customApps.map((a) => (\r\n                  <AppCard to={`${appsPath}?appUrl=${encodeURI(a.url)}`} key={a.id} app={a} onRemove={setAppToRemove} />\r\n                ))}\r\n              </CardsWrapper>\r\n            </AnimatePresence>\r\n          </Collapse>\r\n        )}\r\n\r\n        <SectionHeading color=\"placeHolder\" strong size=\"md\">\r\n          {appSearch ? 'SEARCH RESULTS' : 'ALL APPS'}\r\n        </SectionHeading>\r\n        {noAppsFound && <NoAppsFound query={appSearch} onWalletConnectSearch={() => setAppSearch('WalletConnect')} />}\r\n        <AnimatePresence>\r\n          <CardsWrapper data-testid={ALL_APPS_LIST_TEST_ID}>\r\n            {!appSearch && <AddCustomAppCard onClick={openAddAppModal} />}\r\n            {apps.map((a) => (\r\n              <AppCard\r\n                to={`${appsPath}?appUrl=${encodeURIComponent(a.url)}`}\r\n                key={a.id}\r\n                app={a}\r\n                onPin={handleAppPin}\r\n                pinned={pinnedSafeApps.some((pinnedApp) => pinnedApp.id === a.id)}\r\n              />\r\n            ))}\r\n          </CardsWrapper>\r\n        </AnimatePresence>\r\n      </ContentWrapper>\r\n\r\n      <CenterIconText\r\n        color=\"secondary\"\r\n        iconSize=\"sm\"\r\n        iconType=\"info\"\r\n        text=\"These are third-party apps, which means they are not owned, controlled, maintained or audited by Gnosis. Interacting with the apps is at your own risk. Any communication within the Apps is for informational purposes only and must not be construed as investment advice to engage in any transaction.\"\r\n        textSize=\"sm\"\r\n      />\r\n\r\n      {isAddAppModalOpen && (\r\n        <Modal title=\"Add app\" description=\"Add a custom app to the list of apps\" handleClose={closeAddAppModal}>\r\n          <Modal.Header onClose={closeAddAppModal}>\r\n            <Modal.Header.Title>Add custom app</Modal.Header.Title>\r\n          </Modal.Header>\r\n          <AddAppForm closeModal={closeAddAppModal} appList={allApps} onAddApp={addCustomApp} />\r\n        </Modal>\r\n      )}\r\n\r\n      {appToRemove && (\r\n        <Modal title=\"Remove app\" description=\"Confirm for the app removal\" handleClose={() => setAppToRemove(null)}>\r\n          <Modal.Header onClose={() => setAppToRemove(null)}>\r\n            <Modal.Header.Title>Remove app</Modal.Header.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Text size=\"xl\">\r\n              This action will remove{' '}\r\n              <Text size=\"xl\" strong as=\"span\">\r\n                {appToRemove.name}\r\n              </Text>{' '}\r\n              from the interface\r\n            </Text>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Modal.Footer.Buttons\r\n              cancelButtonProps={{ onClick: () => setAppToRemove(null) }}\r\n              confirmButtonProps={{\r\n                color: 'error',\r\n                onClick: () => {\r\n                  removeApp(appToRemove.id)\r\n                  setAppToRemove(null)\r\n                },\r\n                text: 'Remove',\r\n              }}\r\n            />\r\n          </Modal.Footer>\r\n        </Modal>\r\n      )}\r\n    </Wrapper>\r\n  )\r\n}\r\n\r\nexport default AppsList\r\n","import { useMemo } from 'react'\r\nimport Fuse from 'fuse.js'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\n\r\nconst useAppsSearch = (apps: SafeApp[], searchText: string): SafeApp[] => {\r\n  const fuse = useMemo(\r\n    () =>\r\n      new Fuse(apps, {\r\n        keys: ['name', 'description'],\r\n        // https://fusejs.io/api/options.html#threshold\r\n        // Very naive explanation: threshold represents how accurate the search results should be. The default is 0.6\r\n        // I tested it and found it to make the search results more accurate when the threshold is 0.2\r\n        // 0 - 1, where 0 is the exact match and 1 matches anything\r\n        threshold: 0.2,\r\n        findAllMatches: true,\r\n      }),\r\n    [apps],\r\n  )\r\n\r\n  const results = useMemo(\r\n    () => (searchText ? fuse.search(searchText).map((result) => result.item) : apps),\r\n    [fuse, apps, searchText],\r\n  )\r\n\r\n  return results\r\n}\r\n\r\nexport { useAppsSearch }\r\n","import { FixedDialog, Text } from '@gnosis.pm/safe-react-components'\r\n\r\ninterface OwnProps {\r\n  onCancel: () => void\r\n  onConfirm: () => void\r\n}\r\n\r\nconst LegalDisclaimer = ({ onCancel, onConfirm }: OwnProps): JSX.Element => (\r\n  <FixedDialog\r\n    body={\r\n      <>\r\n        <Text size=\"md\">\r\n          You are now accessing third-party apps, which we do not own, control, maintain or audit. We are not liable for\r\n          any loss you may suffer in connection with interacting with the apps, which is at your own risk. You must read\r\n          our Terms, which contain more detailed provisions binding on you relating to the apps.\r\n        </Text>\r\n        <br />\r\n        <Text size=\"md\">\r\n          I have read and understood the{' '}\r\n          <a href=\"https://gnosis-safe.io/terms\" rel=\"noopener noreferrer\" target=\"_blank\">\r\n            Terms\r\n          </a>{' '}\r\n          and this Disclaimer, and agree to be bound by them.\r\n        </Text>\r\n      </>\r\n    }\r\n    onCancel={onCancel}\r\n    onConfirm={onConfirm}\r\n    title=\"Disclaimer\"\r\n  />\r\n)\r\n\r\nexport default LegalDisclaimer\r\n","import { useState, useEffect, useCallback } from 'react'\r\nimport { loadFromStorage, saveToStorage } from 'src/utils/storage'\r\n\r\nconst APPS_LEGAL_CONSENT_RECEIVED = 'APPS_LEGAL_CONSENT_RECEIVED'\r\n\r\nconst useLegalConsent = (): { consentReceived: boolean | undefined; onConsentReceipt: () => void } => {\r\n  const [consentReceived, setConsentReceived] = useState<boolean | undefined>()\r\n\r\n  useEffect(() => {\r\n    setConsentReceived(loadFromStorage(APPS_LEGAL_CONSENT_RECEIVED) || false)\r\n  }, [])\r\n\r\n  const onConsentReceipt = useCallback((): void => {\r\n    setConsentReceived(true)\r\n    saveToStorage(APPS_LEGAL_CONSENT_RECEIVED, true)\r\n  }, [])\r\n\r\n  return { consentReceived, onConsentReceipt }\r\n}\r\n\r\nexport { useLegalConsent }\r\n","import { useHistory } from 'react-router-dom'\r\n\r\nimport { useSafeAppUrl } from 'src/logic/hooks/useSafeAppUrl'\r\nimport AppFrame from 'src/routes/safe/components/Apps/components/AppFrame'\r\nimport AppsList from 'src/routes/safe/components/Apps/components/AppsList'\r\nimport LegalDisclaimer from 'src/routes/safe/components/Apps/components/LegalDisclaimer'\r\nimport { useLegalConsent } from 'src/routes/safe/components/Apps/hooks/useLegalConsent'\r\n\r\nconst Apps = (): React.ReactElement => {\r\n  const history = useHistory()\r\n  const { getAppUrl } = useSafeAppUrl()\r\n  const url = getAppUrl()\r\n  const { consentReceived, onConsentReceipt } = useLegalConsent()\r\n\r\n  const goBack = () => history.goBack()\r\n\r\n  if (url) {\r\n    if (!consentReceived) {\r\n      return <LegalDisclaimer onCancel={goBack} onConfirm={onConsentReceipt} />\r\n    }\r\n\r\n    return <AppFrame appUrl={url} />\r\n  } else {\r\n    return <AppsList />\r\n  }\r\n}\r\n\r\nexport default Apps\r\n"],"sourceRoot":""}